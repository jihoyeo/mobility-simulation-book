

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>3. Models for Predicting Estimated Time of Arrival &#8212; Digital Twin for Urban Mobility Systems</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ko/chapter3';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="2. Data Preparation" href="chapter2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Digital Twin for Urban Mobility Systems - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Digital Twin for Urban Mobility Systems - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Urban Mobility Simulation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter1.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter2.html">2. Data Preparation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">3. Models for Predicting Estimated Time of Arrival</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fko/chapter3.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/ko/chapter3.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>3. Models for Predicting Estimated Time of Arrival</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-learning-models">3.1 Machine Learning Models 개요</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">3.1.1 머신러닝을 공부하기 위한 교재 추천</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">3.1.2 도시/교통 분야에서의 머신러닝 응용사례</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#supervised-learning">지도학습 (Supervised Learning)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unsupervised-learning">비지도 학습 (Unsupervised Learning)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eta-estimated-time-of-arrival-models-o-d-based-travel-time-prediction">3.2 ETA (Estimated Time of Arrival) Models (O-D based Travel Time Prediction)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-definitions-for-predicting-estimated-time-of-arrival">3.2.1 Problem Definitions for Predicting Estimated Time of Arrival</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">3.2.2 Data Preparation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda-exploratory-data-analysis">3.2.3 EDA (Exploratory Data Analysis)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">[1] 시간 변수 가공</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">[2] 결측치 확인</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#target">[3] 입력변수들의 분포 및 Target 변수와의 관계 분석</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">[4] 공간 시각화</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">[5] 공간 시각화 기반의 데이터 처리</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">3.2.4 Data Preprocessing (파이프라인 구축)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-model">3.2.5 Construct Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation">3.2.6 Validation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">3.3 Exercise</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-link-based-travel-time-prediction">3.3.1 Construct Link-based Travel Time Prediction</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">[1] 데이터 읽기</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">[2] EDA (탐색적 데이터 분석)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">[3] 전처리 파이프라인 구축</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">[4] 모델 학습</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="models-for-predicting-estimated-time-of-arrival">
<h1>3. Models for Predicting Estimated Time of Arrival<a class="headerlink" href="#models-for-predicting-estimated-time-of-arrival" title="Permalink to this heading">#</a></h1>
<section id="machine-learning-models">
<h2>3.1 Machine Learning Models 개요<a class="headerlink" href="#machine-learning-models" title="Permalink to this heading">#</a></h2>
<section id="id1">
<h3>3.1.1 머신러닝을 공부하기 위한 교재 추천<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>본 장에서는 ETA(통행시간예측) 모델을 만들기 위한 기초적인 머신러닝 이론을 공부한다.<br />
기초적인 지식을 위해 아래의 교재를 공부하기를 추천한다.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.oreilly.com/library/view/hands-on-machine-learning/9781098125967/">Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow, 3rd Edition, Aurélien Géron</a></p></li>
<li><p>강의노트(원서): <a class="github reference external" href="https://github.com/ageron/handson-ml3">ageron/handson-ml3</a></p></li>
<li><p><a class="reference external" href="https://www.hanbit.co.kr/store/books/look.php?p_code=B1539397165">(번역서)핸즈온 머신러닝 3판</a></p></li>
<li><p>강의노트(번역): <a class="github reference external" href="https://github.com/rickiepark/handson-ml3">rickiepark/handson-ml3</a></p></li>
</ul>
<p>해당 교재는 머신러닝의 기초부터, 딥러닝까지 폭넓게 다루고 있으며 각 챕터마다의 상세한 예제 코드 파일을 함께 제공 하고 있어, 초심자가 공부하기에 적합하다.<br />
하지만, 본 교재에서 모두 다루기에는 양이 방대하므로, 머신러닝에 집중해서 공부를 하는 것을 추천하며, 그 중에서도 1장, 2장, 3장, 6장, 7장까지 공부하여 Supervised Learning의 개념을 이해하고, 그 중에서도 가장 널리 쓰이는 Ensemble Model에 대해 이해하는 것이 중요하다.</p>
</section>
<section id="id2">
<h3>3.1.2 도시/교통 분야에서의 머신러닝 응용사례<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>도시와 교통 분야에서 머신러닝 기술은 다양한 문제 해결과 의사결정 지원에 활용되고 있다. 지도학습과 비지도학습 기법을 통해 복잡한 도시 시스템을 분석하고 최적화하는 데 큰 기여를 하고 있다. 본 절에서는 주요 응용사례를 살펴본다.</p>
<section id="supervised-learning">
<h4>지도학습 (Supervised Learning)<a class="headerlink" href="#supervised-learning" title="Permalink to this heading">#</a></h4>
<p>지도학습은 레이블이 지정된 데이터를 사용하여 입력과 출력 사이의 관계를 학습하는 머신러닝 기법이다. 이 방법은 과거의 데이터와 그에 대응하는 결과(레이블)를 바탕으로 모델을 훈련시켜, 새로운 데이터에 대한 예측이나 분류를 수행한다. 지도학습의 주요 목적은 입력 데이터로부터 정확한 출력을 예측하는 함수를 찾는 것이다.
도시 및 교통 분야에서 지도학습은 주로 다음과 같은 목적으로 활용된다:</p>
<ul class="simple">
<li><p>미래의 상황이나 수치를 예측하는 회귀(Regression) 분석</p></li>
<li><p>데이터를 특정 범주로 분류하는 분류(Classification) 작업</p></li>
<li><p>시계열 데이터를 분석하여 미래 트렌드를 예측하는 작업</p></li>
</ul>
<p>이러한 기법들은 도시 계획, 교통 관리, 안전 시스템 등 다양한 영역에서 중요한 역할을 한다. 다음은 도시/교통 분야에서의 대표적인 지도학습 응용 사례들이다:</p>
<ul class="simple">
<li><p><strong>통행수요 예측</strong>: 통행수요 예측은 특정 지역이나 노선의 미래 통행량을 예측하는 모델이다. 이 모델은 과거 통행 데이터, 인구통계, 경제지표, 날씨 등의 특성을 입력으로 사용한다. 예측 결과는 대중교통 노선 계획이나 도로 확장 계획 수립 등에 활용된다.</p></li>
<li><p><strong>통행시간 예측</strong>: 출발지에서 목적지까지의 예상 소요시간을 예측하는 모델이다. 실시간 교통 데이터, 과거 통행시간 패턴, 도로 상태 등을 고려하여 예측을 수행한다. 이는 네비게이션 서비스나 교통정보 제공 시스템에서 중요한 역할을 한다.</p></li>
<li><p><strong>통행속도 예측</strong>: 특정 도로나 구간의 미래 통행속도를 예측하는 모델이다. 현재 교통량, 시간대, 날씨 조건 등을 고려하여 예측을 수행한다. 예측 결과는 교통 흐름 최적화나 신호 제어 시스템 등에 활용된다.</p></li>
<li><p><strong>교통사고 발생(사고위험도) 예측</strong>: 특정 지역이나 도로에서의 교통사고 발생 가능성을 예측하는 모델이다. 도로 설계, 교통량, 날씨, 시간대 등의 요소를 고려하여 위험도를 산출한다. 이는 교통안전 정책 수립이나 위험 구간 개선 등에 중요한 정보를 제공한다.</p></li>
<li><p><strong>주차수요 예측</strong>: 특정 지역이나 시설의 주차 수요를 예측하는 모델이다. 시간대, 요일, 주변 이벤트 등을 고려하여 예측을 수행한다. 예측 결과는 주차 관리 시스템이나 스마트 주차 솔루션 등에 활용된다.</p></li>
<li><p><strong>대중교통 승하차 인원 예측</strong>: 버스나 지하철 역의 시간대별 승하차 인원을 예측하는 모델이다. 과거 데이터, 주변 환경, 이벤트 정보 등을 활용하여 예측을 수행한다. 이는 대중교통 운행 계획 수립이나 혼잡도 관리 등에 중요한 정보를 제공한다.</p></li>
</ul>
</section>
<section id="unsupervised-learning">
<h4>비지도 학습 (Unsupervised Learning)<a class="headerlink" href="#unsupervised-learning" title="Permalink to this heading">#</a></h4>
<p>비지도 학습은 레이블이 지정되지 않은 데이터에서 패턴이나 구조를 찾아내는 머신러닝 기법이다. 이는 주로 데이터의 숨겨진 구조를 발견하거나, 데이터를 의미 있는 방식으로 그룹화하는 데 사용된다. 비지도 학습의 주요 특징은 사전에 정의된 ‘정답’이 없다는 점이다. 대신, 알고리즘이 데이터 자체의 특성을 바탕으로 패턴을 찾아낸다. 도시 및 교통 분야에서 비지도 학습은 주로 다음과 같은 목적으로 활용된다</p>
<ul class="simple">
<li><p>유사한 특성을 가진 데이터 포인트들을 그룹화하는 군집화</p></li>
<li><p>정상 패턴에서 벗어난 데이터를 감지하는 이상치 탐지</p></li>
<li><p>복잡한 고차원 데이터를 더 단순한 저차원으로 변환하는 차원 축소</p></li>
</ul>
<p>이러한 기법들은 도시와 교통 시스템의 복잡한 패턴을 이해하고, 효율적인 관리 및 계획 수립에 중요한 인사이트를 제공한다. 다음은 도시/교통 분야에서의 대표적인 비지도 학습 응용 사례들이다:</p>
<ul class="simple">
<li><p><strong>교통 패턴 군집화</strong>: 유사한 교통 패턴을 가진 지역이나 시간대를 그룹화하는 기법이다. K-means, DBSCAN 등의 알고리즘을 주로 사용한다. 군집화 결과는 교통 정책 수립이나 신호 체계 최적화 등에 활용된다.</p></li>
<li><p><strong>이상 교통 상황 탐지</strong>: 평소와 다른 비정상적인 교통 패턴을 자동으로 감지하는 기법이다. 이상치 탐지 알고리즘을 사용하여 분석을 수행한다. 이는 교통사고, 도로 공사, 대규모 행사 등의 영향을 빠르게 파악하는 데 사용된다.</p></li>
<li><p><strong>도시 기능 지역 분류</strong>: 도시 내 다양한 지역의 기능(주거, 상업, 업무 등)을 자동으로 분류하는 기법이다. 토지 이용 패턴, 건물 형태, 유동인구 데이터 등을 활용하여 분석을 수행한다. 분류 결과는 도시계획이나 토지이용 정책 수립 등에 활용된다.</p></li>
<li><p><strong>차량 주행 패턴 분석</strong>: 차량의 주행 데이터를 분석하여 유사한 주행 패턴을 찾아내는 기법이다. GPS 데이터, 속도 데이터 등을 활용하여 분석을 수행한다. 분석 결과는 친환경 운전 방식 개발이나 차량 설계 최적화 등에 활용된다. 예를들어 버스/택시기사들의 운행기록 데이터 정보가 있다면, 유사하게 운전하는 운전자들끼리 군집화가 가능할 것이며, 이 군집화를 기반으로 운전자들의 성향을 파악하는 것이 가능하다.</p></li>
</ul>
<p>이러한 머신러닝 기법들은 도시와 교통 시스템을 더욱 효율적이고 지속가능하게 만드는 데 중요한 역할을 한다. 실제 적용 시에는 데이터의 품질, 모델의 정확성, 윤리적 고려사항 등 다양한 요소를 종합적으로 고려해야 한다. 도시/교통 분야의 머신러닝 응용에 대한 실제 구현 사례와 코드를 살펴보고 싶다면, GitHub에서 제공하는 ‘Traffic-Prediction-Open-Code-Summary’ 리포지토리를 참고하는 것이 도움이 될 수 있다. 이 리소스는 다양한 교통 예측 모델의 오픈 소스 코드를 제공하고 있어, 실제 구현 방법을 이해하는 데 도움을 준다. 이밖에도 Kaggle, 데이콘, 콤파스 등에 다양한 도시/교통 관련된 머신러닝 문제들과 데이터가 있으니 도전해보면 좋다.</p>
</section>
</section>
</section>
<section id="eta-estimated-time-of-arrival-models-o-d-based-travel-time-prediction">
<h2>3.2 ETA (Estimated Time of Arrival) Models (O-D based Travel Time Prediction)<a class="headerlink" href="#eta-estimated-time-of-arrival-models-o-d-based-travel-time-prediction" title="Permalink to this heading">#</a></h2>
<section id="problem-definitions-for-predicting-estimated-time-of-arrival">
<h3>3.2.1 Problem Definitions for Predicting Estimated Time of Arrival<a class="headerlink" href="#problem-definitions-for-predicting-estimated-time-of-arrival" title="Permalink to this heading">#</a></h3>
<p>도착 예정 시간(ETA, Estimated Time of Arrival) 예측은 교통 및 물류 분야에서 중요한 과제이다. 이 작업의 목표는 차량이 출발지에서 목적지까지 이동하는 데 걸리는 시간을 정확하게 예측하는 것이다. 이 예측은 이동 시간에 영향을 미칠 수 있는 다양한 요인들을 기반으로 한다.</p>
<p>ETA 예측 문제는 다음과 같이 공식적으로 정의할 수 있다:</p>
<p>입력 특성 집합 <span class="math notranslate nohighlight">\(X = \{x_1, x_2, ..., x_n\}\)</span>이 주어졌을 때, 각 <span class="math notranslate nohighlight">\(x_i\)</span>는 다음과 같은 관련 요인을 나타낸다:</p>
<ul class="simple">
<li><p>출발지와 목적지의 위도 및 경도 좌표</p></li>
<li><p>출발지와 목적지 사이의 직선 거리</p></li>
<li><p>출발 시간</p></li>
<li><p>요일</p></li>
<li><p>공휴일 여부</p></li>
<li><p>출발지와 목적지의 행정 구역</p></li>
</ul>
<p>목표는 이러한 입력 특성을 사용하여 예상 도착 시간 <span class="math notranslate nohighlight">\(y\)</span>를 예측하는 함수 <span class="math notranslate nohighlight">\(f\)</span>를 학습하는 것이다:</p>
<p><span class="math notranslate nohighlight">\(y = f(X)\)</span></p>
<p>여기서 <span class="math notranslate nohighlight">\(y\)</span>는 분 단위의 예상 이동 시간을 나타낸다.</p>
</section>
<section id="data-preparation">
<h3>3.2.2 Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this heading">#</a></h3>
<p>이 단계에서는 ETA 예측을 위한 데이터를 수집하고 정리한다. 주요 작업으로는 다양한 소스에서 데이터를 수집하고, 데이터의 일관성을 확인하며, 누락된 값이나 이상치를 처리하는 것이 포함된다. 또한 데이터의 형식을 통일하고, 필요한 경우 데이터를 결합하는 작업도 수행한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">osmnx</span> <span class="k">as</span> <span class="nn">ox</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">osmnx</span> <span class="k">as</span> <span class="nn">ox</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;pandas&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../data/chp3_tx_data_ML.parquet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># RIDE_DTIME을 datetime으로 변환</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;RIDE_DTIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RIDE_DTIME&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ALIGHT_DTIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ALIGHT_DTIME&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># target</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TRAVEL_TIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ALIGHT_DTIME&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;RIDE_DTIME&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RIDE_DTIME</th>
      <th>RIDE_POS_X</th>
      <th>RIDE_POS_Y</th>
      <th>ALIGHT_DTIME</th>
      <th>ALIGHT_POS_X</th>
      <th>ALIGHT_POS_Y</th>
      <th>TRAVEL_TIME</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2022-05-21 11:01:23</td>
      <td>127.028467</td>
      <td>37.585553</td>
      <td>2022-05-21 11:17:41</td>
      <td>127.022692</td>
      <td>37.612146</td>
      <td>16.300000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2022-05-29 03:39:50</td>
      <td>126.928486</td>
      <td>37.486230</td>
      <td>2022-05-29 03:54:18</td>
      <td>126.875179</td>
      <td>37.466892</td>
      <td>14.466667</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2022-05-17 23:18:19</td>
      <td>127.029616</td>
      <td>37.499293</td>
      <td>2022-05-17 23:35:26</td>
      <td>127.117172</td>
      <td>37.499710</td>
      <td>17.116667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2022-05-05 23:19:29</td>
      <td>126.973678</td>
      <td>37.580075</td>
      <td>2022-05-05 23:26:31</td>
      <td>126.975649</td>
      <td>37.552622</td>
      <td>7.033333</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2022-05-28 05:00:48</td>
      <td>126.921493</td>
      <td>37.555215</td>
      <td>2022-05-28 05:14:48</td>
      <td>126.859654</td>
      <td>37.547189</td>
      <td>14.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4548922</th>
      <td>2022-05-14 21:16:18</td>
      <td>126.890544</td>
      <td>37.506478</td>
      <td>2022-05-14 21:31:29</td>
      <td>126.855718</td>
      <td>37.503107</td>
      <td>15.183333</td>
    </tr>
    <tr>
      <th>4548923</th>
      <td>2022-05-20 06:54:45</td>
      <td>127.042237</td>
      <td>37.662474</td>
      <td>2022-05-20 06:58:22</td>
      <td>127.034707</td>
      <td>37.648935</td>
      <td>3.616667</td>
    </tr>
    <tr>
      <th>4548924</th>
      <td>2022-05-12 05:11:36</td>
      <td>126.851621</td>
      <td>37.508182</td>
      <td>2022-05-12 05:27:07</td>
      <td>126.904974</td>
      <td>37.512342</td>
      <td>15.516667</td>
    </tr>
    <tr>
      <th>4548925</th>
      <td>2022-05-24 13:03:07</td>
      <td>126.979372</td>
      <td>37.548261</td>
      <td>2022-05-24 13:19:39</td>
      <td>126.941519</td>
      <td>37.561741</td>
      <td>16.533333</td>
    </tr>
    <tr>
      <th>4548926</th>
      <td>2022-05-15 18:07:40</td>
      <td>126.973236</td>
      <td>37.535928</td>
      <td>2022-05-15 18:14:15</td>
      <td>127.001178</td>
      <td>37.537362</td>
      <td>6.583333</td>
    </tr>
  </tbody>
</table>
<p>4548927 rows × 7 columns</p>
</div></div></div>
</div>
</section>
<section id="eda-exploratory-data-analysis">
<h3>3.2.3 EDA (Exploratory Data Analysis)<a class="headerlink" href="#eda-exploratory-data-analysis" title="Permalink to this heading">#</a></h3>
<p>탐색적 데이터 분석 단계에서는 수집된 데이터의 특성과 패턴을 파악한다. 여기에는 각 변수의 분포 확인, 변수 간 상관관계 분석, 시간에 따른 추세 파악 등이 포함된다. 또한 이상치나 특이점을 식별하고, 데이터의 품질을 평가하는 작업도 수행한다. 이 과정을 통해 모델 구축에 유용한 인사이트를 얻을 수 있다.</p>
<section id="id3">
<h4>[1] 시간 변수 가공<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>RIDE_DTIME을 기준으로, 요일, 시간, 휴일여부 등을 매핑</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 요일 추출 (0: 월요일, 6: 일요일)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;DAY_OF_WEEK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;RIDE_DTIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>

<span class="c1"># 시간 추출</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;HOUR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;RIDE_DTIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>

<span class="c1"># 주말 여부 (1: 주말, 0: 평일)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;IS_WEEKEND&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;DAY_OF_WEEK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># 공휴일 여부 (예시로 몇 개의 공휴일만 포함)</span>
<span class="n">holidays</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2022-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2022-03-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2022-05-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2022-08-15&#39;</span><span class="p">,</span> <span class="s1">&#39;2022-10-03&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;IS_HOLIDAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;RIDE_DTIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">holidays</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h4>[2] 결측치 확인<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>데이터의 결측치를 확인한다.</p></li>
<li><p>향후 데이터 전처리 파이프라인 구축할 때 결측치에 대해 처리할 수 있다.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 결측치 확인</span>
<span class="n">missing_count</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">missing_percentage</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">missing_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">missing_count</span><span class="p">,</span> <span class="n">missing_percentage</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Missing Count&#39;</span><span class="p">,</span> <span class="s1">&#39;Missing Percentage(%)&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">missing_info</span><span class="p">)</span>

<span class="c1"># 결측치가 있는 열만 표시</span>
<span class="n">columns_with_missing</span> <span class="o">=</span> <span class="n">missing_info</span><span class="p">[</span><span class="n">missing_info</span><span class="p">[</span><span class="s1">&#39;Missing Count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">columns_with_missing</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Columns with missing values:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">columns_with_missing</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No missing values in any column.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Missing Count  Missing Percentage(%)
RIDE_DTIME                0                    0.0
RIDE_POS_X                0                    0.0
RIDE_POS_Y                0                    0.0
ALIGHT_DTIME              0                    0.0
ALIGHT_POS_X              0                    0.0
ALIGHT_POS_Y              0                    0.0
TRAVEL_TIME               0                    0.0
DAY_OF_WEEK               0                    0.0
HOUR                      0                    0.0
IS_WEEKEND                0                    0.0
IS_HOLIDAY                0                    0.0

No missing values in any column.
</pre></div>
</div>
</div>
</div>
</section>
<section id="target">
<h4>[3] 입력변수들의 분포 및 Target 변수와의 관계 분석<a class="headerlink" href="#target" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RIDE_DTIME</th>
      <th>RIDE_POS_X</th>
      <th>RIDE_POS_Y</th>
      <th>ALIGHT_DTIME</th>
      <th>ALIGHT_POS_X</th>
      <th>ALIGHT_POS_Y</th>
      <th>TRAVEL_TIME</th>
      <th>DAY_OF_WEEK</th>
      <th>HOUR</th>
      <th>IS_WEEKEND</th>
      <th>IS_HOLIDAY</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4548927</td>
      <td>4.548927e+06</td>
      <td>4.548927e+06</td>
      <td>4548927</td>
      <td>4.548927e+06</td>
      <td>4.548927e+06</td>
      <td>4.548927e+06</td>
      <td>4.548927e+06</td>
      <td>4.548927e+06</td>
      <td>4.548927e+06</td>
      <td>4.548927e+06</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2022-05-16 17:19:02.734734592</td>
      <td>1.269980e+02</td>
      <td>3.754447e+01</td>
      <td>2022-05-16 17:35:58.240318720</td>
      <td>1.269958e+02</td>
      <td>3.754313e+01</td>
      <td>1.692509e+01</td>
      <td>2.905811e+00</td>
      <td>1.258344e+01</td>
      <td>2.752887e-01</td>
      <td>3.032561e-02</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2022-05-01 00:00:00</td>
      <td>1.267683e+02</td>
      <td>3.742966e+01</td>
      <td>2022-05-01 00:01:09</td>
      <td>1.231249e+02</td>
      <td>3.274790e+01</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2022-05-09 06:59:27</td>
      <td>1.269269e+02</td>
      <td>3.750707e+01</td>
      <td>2022-05-09 07:17:55.500000</td>
      <td>1.269245e+02</td>
      <td>3.750529e+01</td>
      <td>7.833333e+00</td>
      <td>1.000000e+00</td>
      <td>8.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2022-05-16 19:45:01</td>
      <td>1.270146e+02</td>
      <td>3.753917e+01</td>
      <td>2022-05-16 19:59:45</td>
      <td>1.270137e+02</td>
      <td>3.753957e+01</td>
      <td>1.360000e+01</td>
      <td>3.000000e+00</td>
      <td>1.300000e+01</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2022-05-24 11:35:28</td>
      <td>1.270589e+02</td>
      <td>3.757095e+01</td>
      <td>2022-05-24 11:51:39.500000</td>
      <td>1.270622e+02</td>
      <td>3.757587e+01</td>
      <td>2.265000e+01</td>
      <td>5.000000e+00</td>
      <td>1.800000e+01</td>
      <td>1.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2022-05-31 23:59:59</td>
      <td>1.271836e+02</td>
      <td>3.769519e+01</td>
      <td>2022-06-01 02:48:30</td>
      <td>1.321688e+02</td>
      <td>4.343108e+01</td>
      <td>3.595333e+02</td>
      <td>6.000000e+00</td>
      <td>2.300000e+01</td>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>std</th>
      <td>NaN</td>
      <td>8.183963e-02</td>
      <td>4.747806e-02</td>
      <td>NaN</td>
      <td>9.615875e-02</td>
      <td>6.345347e-02</td>
      <td>1.272693e+01</td>
      <td>2.022310e+00</td>
      <td>6.842493e+00</td>
      <td>4.466597e-01</td>
      <td>1.714817e-01</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># 범주형 변수 컬럼 추출</span>
<span class="n">categorical_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DAY_OF_WEEK&#39;</span><span class="p">,</span> <span class="s1">&#39;HOUR&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_WEEKEND&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_HOLIDAY&#39;</span><span class="p">]</span>

<span class="n">df_categorical</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">categorical_columns</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_categorical</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Subplot 그리는 함수 생성</span>
<span class="k">def</span> <span class="nf">make_subplot_layout</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col_num</span><span class="p">):</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">row_num</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">k</span> <span class="o">/</span> <span class="n">col_num</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">col_num</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">row_num</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">row_num</span><span class="p">,</span> <span class="n">col_num</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> Countplot&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 범주형 변수 시각화</span>
<span class="n">make_subplot_layout</span><span class="p">(</span><span class="n">df_categorical</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4548927, 4)
</pre></div>
</div>
<img alt="../_images/2402c5776104aa41f06a9bf803c0469b76682b64e259b99fb12e97607214ff2c.png" src="../_images/2402c5776104aa41f06a9bf803c0469b76682b64e259b99fb12e97607214ff2c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 수치형 변수 컬럼 추출</span>
<span class="n">numeric_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RIDE_POS_X&#39;</span><span class="p">,</span> <span class="s1">&#39;RIDE_POS_Y&#39;</span><span class="p">,</span> <span class="s1">&#39;ALIGHT_POS_X&#39;</span><span class="p">,</span> <span class="s1">&#39;ALIGHT_POS_Y&#39;</span><span class="p">,</span> <span class="s1">&#39;TRAVEL_TIME&#39;</span><span class="p">]</span>

<span class="c1"># 수치형 변수의 분포 시각화</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> Distribution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ad0b3c5fbe7ac21d65391f1bcdbcc75c437f56ea580fef64dcb3cbe875e967d9.png" src="../_images/ad0b3c5fbe7ac21d65391f1bcdbcc75c437f56ea580fef64dcb3cbe875e967d9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TRAVEL_TIME과 다른 변수들의 관계 시각화</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorical_columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">categorical_columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;TRAVEL_TIME&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorical_columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;TRAVEL_TIME&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;TRAVEL_TIME&#39;</span><span class="p">,</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> vs TRAVEL_TIME&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4285137b55379eea4b4a7827674cf1b1a8ac6c6200846575998a56cfcdafe461.png" src="../_images/4285137b55379eea4b4a7827674cf1b1a8ac6c6200846575998a56cfcdafe461.png" />
</div>
</div>
</section>
<section id="id5">
<h4>[4] 공간 시각화<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pydeck</span> <span class="k">as</span> <span class="nn">pdk</span>

<span class="c1"># 데이터 준비 (df는 이미 로드된 데이터프레임이라고 가정)</span>
<span class="n">df_sample</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>  <span class="c1"># 성능을 위해 샘플링</span>

<span class="c1"># 승차 위치 데이터</span>
<span class="n">ride_data</span> <span class="o">=</span> <span class="n">df_sample</span><span class="p">[[</span><span class="s1">&#39;RIDE_POS_X&#39;</span><span class="p">,</span> <span class="s1">&#39;RIDE_POS_Y&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;RIDE_POS_X&#39;</span><span class="p">:</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;RIDE_POS_Y&#39;</span><span class="p">:</span> <span class="s1">&#39;lat&#39;</span><span class="p">})</span>

<span class="c1"># 하차 위치 데이터</span>
<span class="n">alight_data</span> <span class="o">=</span> <span class="n">df_sample</span><span class="p">[[</span><span class="s1">&#39;ALIGHT_POS_X&#39;</span><span class="p">,</span> <span class="s1">&#39;ALIGHT_POS_Y&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ALIGHT_POS_X&#39;</span><span class="p">:</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;ALIGHT_POS_Y&#39;</span><span class="p">:</span> <span class="s1">&#39;lat&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 승차 위치 시각화 함수</span>
<span class="k">def</span> <span class="nf">visualize_hexagon</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">):</span>
    <span class="n">center_lat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">center_lon</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">layer</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span>
        <span class="s1">&#39;HexagonLayer&#39;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">get_position</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">],</span>
        <span class="n">radius</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">elevation_scale</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">elevation_range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
        <span class="n">pickable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">extruded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">layer_id</span>
    <span class="p">)</span>

    <span class="n">view_state</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">ViewState</span><span class="p">(</span>
        <span class="n">latitude</span><span class="o">=</span><span class="n">center_lat</span><span class="p">,</span>
        <span class="n">longitude</span><span class="o">=</span><span class="n">center_lon</span><span class="p">,</span>
        <span class="n">zoom</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">pitch</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">tooltip</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;b&gt;개수:&lt;/b&gt; </span><span class="si">{elevationValue}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;background&quot;</span><span class="p">:</span> <span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;Helvetica Neue&quot;, Arial&#39;</span><span class="p">,</span> <span class="s2">&quot;z-index&quot;</span><span class="p">:</span> <span class="s2">&quot;10000&quot;</span><span class="p">}</span>
    <span class="p">}</span>

    <span class="n">legend</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span>
        <span class="s2">&quot;TextLayer&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">center_lon</span><span class="p">,</span> <span class="n">center_lat</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;택시 승하차 밀집도&quot;</span><span class="p">}],</span>
        <span class="n">get_position</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
        <span class="n">get_text</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
        <span class="n">get_size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
        <span class="n">get_color</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
        <span class="n">get_alignment_baseline</span><span class="o">=</span><span class="s2">&quot;&#39;bottom&#39;&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">Deck</span><span class="p">(</span>
        <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="n">layer</span><span class="p">,</span> <span class="n">legend</span><span class="p">],</span>
        <span class="n">initial_view_state</span><span class="o">=</span><span class="n">view_state</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">r</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 승차 위치 시각화</span>
<span class="c1"># ride_visualization = visualize_hexagon(ride_data, &#39;ride_layer&#39;)</span>
<span class="c1"># ride_visualization.to_html(&quot;../outputs/taxi_ride_map.html&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 하차 위치 시각화</span>
<span class="c1"># alight_visualization = visualize_hexagon(alight_data, &#39;alight_layer&#39;)</span>
<span class="c1"># alight_visualization.to_html(&quot;../outputs/taxi_alight_map.html&quot;)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h4>[5] 공간 시각화 기반의 데이터 처리<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>위와 같은 승차위치와 하차위치의 공간분포 차이는 왜 발생할까요?</p></li>
<li><p>우리가 만드는 통행시간 예측 머신러닝 모델을 만들때 주의해야 할 부분이 있을까요?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### 서울 bbox 안에 있지 않은 ride, alight은 제거</span>
<span class="n">place_inf</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">geocode_to_gdf</span><span class="p">([</span><span class="s1">&#39;서울 대한민국&#39;</span><span class="p">])</span>

<span class="c1">## - 서울 bbox (lat, lon)</span>
<span class="c1"># latitude</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">place_inf</span><span class="p">[[</span><span class="s1">&#39;bbox_south&#39;</span><span class="p">,</span> <span class="s1">&#39;bbox_north&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1"># longitute</span>
<span class="n">lon</span> <span class="o">=</span> <span class="n">place_inf</span><span class="p">[[</span><span class="s1">&#39;bbox_west&#39;</span><span class="p">,</span> <span class="s1">&#39;bbox_east&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RIDE_POS_Y&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RIDE_POS_Y&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">lat</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> 
                            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RIDE_POS_X&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RIDE_POS_X&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">lon</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ALIGHT_POS_Y&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;ALIGHT_POS_Y&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">lat</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> 
                            <span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;ALIGHT_POS_X&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;ALIGHT_POS_X&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">lon</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_filtered</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4332957, 11)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;ALIGHT_POS_X&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;ALIGHT_POS_X&#39;, ylabel=&#39;Count&#39;&gt;
</pre></div>
</div>
<img alt="../_images/ed4a70431473cf0991cdcb58922f3005cc2f052298af06ccf891e40f174015b5.png" src="../_images/ed4a70431473cf0991cdcb58922f3005cc2f052298af06ccf891e40f174015b5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;ALIGHT_POS_Y&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;ALIGHT_POS_Y&#39;, ylabel=&#39;Count&#39;&gt;
</pre></div>
</div>
<img alt="../_images/2392c88792b9b0f89d6deb76f39c0668899f725fd2084918071d07b214c9d9b8.png" src="../_images/2392c88792b9b0f89d6deb76f39c0668899f725fd2084918071d07b214c9d9b8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 데이터 준비 (df는 이미 로드된 데이터프레임이라고 가정)</span>
<span class="n">df_sample</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>  <span class="c1"># 성능을 위해 샘플링</span>

<span class="c1"># 하차 위치 데이터</span>
<span class="n">alight_data</span> <span class="o">=</span> <span class="n">df_sample</span><span class="p">[[</span><span class="s1">&#39;ALIGHT_POS_X&#39;</span><span class="p">,</span> <span class="s1">&#39;ALIGHT_POS_Y&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ALIGHT_POS_X&#39;</span><span class="p">:</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;ALIGHT_POS_Y&#39;</span><span class="p">:</span> <span class="s1">&#39;lat&#39;</span><span class="p">})</span>

<span class="c1"># visualize_hexagon(alight_data, &#39;alight_layer&#39;)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="data-preprocessing">
<h3>3.2.4 Data Preprocessing (파이프라인 구축)<a class="headerlink" href="#data-preprocessing" title="Permalink to this heading">#</a></h3>
<p>전처리 단계에서는 원시 데이터를 모델 학습에 적합한 형태로 변환한다. 이 과정에는 특성 스케일링, 범주형 변수의 인코딩, 결측치 처리 등이 포함된다. 또한 효율적이고 일관된 데이터 처리를 위해 전처리 파이프라인을 구축한다.<br />
이 파이프라인은 향후 새로운 데이터에 대해서도 동일한 전처리를 적용할 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 데이터 전처리 파이프라인 구축</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  train_test_split 수행</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;TRAVEL_TIME&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;TRAVEL_TIME&#39;</span><span class="p">]</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 수치형 변수와 범주형 변수 구분</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RIDE_POS_X&#39;</span><span class="p">,</span> <span class="s1">&#39;RIDE_POS_Y&#39;</span><span class="p">,</span> <span class="s1">&#39;ALIGHT_POS_X&#39;</span><span class="p">,</span> <span class="s1">&#39;ALIGHT_POS_Y&#39;</span><span class="p">]</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DAY_OF_WEEK&#39;</span><span class="p">,</span> <span class="s1">&#39;HOUR&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_WEEKEND&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_HOLIDAY&#39;</span><span class="p">]</span>

<span class="c1"># 수치형 변수 전처리 파이프라인</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="p">])</span>

<span class="c1"># 범주형 변수 전처리 파이프라인</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;onehot&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># 전체 전처리 파이프라인</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">])</span>

<span class="c1"># 필요한 특성만 선택</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">numeric_features</span> <span class="o">+</span> <span class="n">categorical_features</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">numeric_features</span> <span class="o">+</span> <span class="n">categorical_features</span><span class="p">]</span>

<span class="c1"># 전처리 파이프라인 적용</span>
<span class="c1"># train set에 fit_transform 적용</span>
<span class="n">X_train_preprocessed</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="c1"># test set에는 transform만 적용</span>
<span class="n">X_test_preprocessed</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;전처리 완료&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>전처리 완료
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 전처리된 특성 이름 가져오기</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>

<span class="c1"># 특성 이름 출력</span>
<span class="nb">print</span><span class="p">(</span><span class="n">feature_names</span><span class="p">)</span>

<span class="c1"># 특성의 총 개수 출력</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;전체 특성 개수: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;num__RIDE_POS_X&#39; &#39;num__RIDE_POS_Y&#39; &#39;num__ALIGHT_POS_X&#39;
 &#39;num__ALIGHT_POS_Y&#39; &#39;cat__DAY_OF_WEEK_0&#39; &#39;cat__DAY_OF_WEEK_1&#39;
 &#39;cat__DAY_OF_WEEK_2&#39; &#39;cat__DAY_OF_WEEK_3&#39; &#39;cat__DAY_OF_WEEK_4&#39;
 &#39;cat__DAY_OF_WEEK_5&#39; &#39;cat__DAY_OF_WEEK_6&#39; &#39;cat__HOUR_0&#39; &#39;cat__HOUR_1&#39;
 &#39;cat__HOUR_2&#39; &#39;cat__HOUR_3&#39; &#39;cat__HOUR_4&#39; &#39;cat__HOUR_5&#39; &#39;cat__HOUR_6&#39;
 &#39;cat__HOUR_7&#39; &#39;cat__HOUR_8&#39; &#39;cat__HOUR_9&#39; &#39;cat__HOUR_10&#39; &#39;cat__HOUR_11&#39;
 &#39;cat__HOUR_12&#39; &#39;cat__HOUR_13&#39; &#39;cat__HOUR_14&#39; &#39;cat__HOUR_15&#39;
 &#39;cat__HOUR_16&#39; &#39;cat__HOUR_17&#39; &#39;cat__HOUR_18&#39; &#39;cat__HOUR_19&#39;
 &#39;cat__HOUR_20&#39; &#39;cat__HOUR_21&#39; &#39;cat__HOUR_22&#39; &#39;cat__HOUR_23&#39;
 &#39;cat__IS_WEEKEND_0&#39; &#39;cat__IS_WEEKEND_1&#39; &#39;cat__IS_HOLIDAY_0&#39;
 &#39;cat__IS_HOLIDAY_1&#39;]
전체 특성 개수: 39
</pre></div>
</div>
</div>
</div>
</section>
<section id="construct-model">
<h3>3.2.5 Construct Model<a class="headerlink" href="#construct-model" title="Permalink to this heading">#</a></h3>
<p>모델 구축 단계에서는 ETA 예측을 위한 적절한 머신러닝 또는 딥러닝 모델을 선택하고 구현한다. 다양한 알고리즘을 비교하고, 모델의 구조와 하이퍼파라미터를 최적화하는 작업이 포함된다. 또한 모델의 성능을 향상시키기 위한 앙상블 기법이나 고급 학습 방법을 적용할 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># LightGBM을 사용해서 머신러닝 모델 학습</span>
<span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">randint</span><span class="p">,</span> <span class="n">uniform</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># LightGBM 모델 정의</span>
<span class="n">lgb_model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># 하이퍼파라미터 탐색 공간 정의 (범위 축소)</span>
<span class="n">param_distributions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;num_leaves&#39;</span><span class="p">:</span> <span class="n">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>      <span class="c1"># 트리의 최대 잎 노드 수. 더 많은 잎은 더 복잡한 트리를 의미함</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="c1"># 학습률. 각 트리의 기여도를 조절. 작을수록 과적합 위험은 줄지만 학습에 더 많은 트리가 필요</span>
    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>   <span class="c1"># 생성할 트리의 수. 더 많은 트리는 더 나은 성능을 낼 수 있지만 학습 시간이 증가함</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>           <span class="c1"># 트리의 최대 깊이. 깊을수록 복잡한 관계를 학습할 수 있지만 과적합 위험이 증가함</span>
<span class="p">}</span>

<span class="c1"># RandomizedSearchCV 정의 (iteration 횟수 감소)</span>
<span class="n">random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span>
    <span class="n">lgb_model</span><span class="p">,</span> 
    <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_distributions</span><span class="p">,</span>
    <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span>  <span class="c1"># RMSE를 최소화하기 위해 MSE 사용</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># 모델 학습</span>
<span class="n">random_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_preprocessed</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># 최적 모델 저장</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">random_search</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="c1"># 최적 파라미터 출력</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;최적 파라미터:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">random_search</span><span class="o">.</span><span class="n">best_params_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 최고 성능 출력 (RMSE로 변환)</span>
<span class="n">best_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">random_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;최고 교차 검증 RMSE: </span><span class="si">{</span><span class="n">best_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 3 folds for each of 10 candidates, totalling 30 fits
[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0.036468 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 1090
[LightGBM] [Info] Number of data points in the train set: 3466365, number of used features: 39
[LightGBM] [Info] Start training from score 16.041805
최적 파라미터:
learning_rate: 0.09661761457749352
max_depth: 6
n_estimators: 203
num_leaves: 43
최고 교차 검증 RMSE: 6.4892
</pre></div>
</div>
</div>
</div>
</section>
<section id="validation">
<h3>3.2.6 Validation<a class="headerlink" href="#validation" title="Permalink to this heading">#</a></h3>
<p>검증 단계에서는 구축된 모델의 성능을 평가한다. 교차 검증이나 홀드아웃 검증과 같은 기법을 사용하여 모델의 일반화 능력을 측정한다. 평가 지표로는 평균 절대 오차(MAE), 평균 제곱근 오차(RMSE) 등을 사용할 수 있다. 또한 모델의 예측 결과를 실제 값과 비교하여 모델의 강점과 약점을 분석한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 테스트 세트에서 성능 평가</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_preprocessed</span><span class="p">)</span>
<span class="n">test_mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)</span>
<span class="n">test_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">test_mse</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;테스트 세트 RMSE: </span><span class="si">{</span><span class="n">test_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exercise">
<h2>3.3 Exercise<a class="headerlink" href="#exercise" title="Permalink to this heading">#</a></h2>
<section id="construct-link-based-travel-time-prediction">
<h3>3.3.1 Construct Link-based Travel Time Prediction<a class="headerlink" href="#construct-link-based-travel-time-prediction" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>아래의 데이터를 사용해서 간단히 데이터를 분석한 후, 머신러닝 모델을 만들어 봅시다</p></li>
<li><p>앞서 배운 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>에서 제공하는 파이프라인을 적극 활용해 보세요</p></li>
</ul>
<section id="id7">
<h4>[1] 데이터 읽기<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MacOS에서 한글폰트 안깨지게 하는 코드</span>
<span class="c1"># import matplotlib.pyplot as plt</span>
<span class="c1"># import matplotlib</span>

<span class="c1"># plt.rc(&#39;font&#39;, family=&#39;AppleGothic&#39;)</span>
<span class="c1"># matplotlib.rcParams[&#39;axes.unicode_minus&#39;] = False</span>
<span class="c1"># %matplotlib inline</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># 노트북이 코랩에서 실행 중인지 체크합니다.</span>
<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="o">!</span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;debconf debconf/frontend select Noninteractive&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>debconf-set-selections
    <span class="c1"># 나눔 폰트를 설치합니다.</span>
    <span class="o">!</span>sudo<span class="w"> </span>apt-get<span class="w"> </span>-qq<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>fonts-nanum
    <span class="kn">import</span> <span class="nn">matplotlib.font_manager</span> <span class="k">as</span> <span class="nn">fm</span>
    <span class="n">font_files</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">findSystemFonts</span><span class="p">(</span><span class="n">fontpaths</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;/usr/share/fonts/truetype/nanum&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">font_files</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">fontManager</span><span class="o">.</span><span class="n">addfont</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

    <span class="c1"># 나눔바른고딕 폰트로 설정합니다.</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;NanumBarunGothic&#39;</span><span class="p">)</span>
    <span class="c1"># 마이너스 기호 표시 오류 수정</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;../data/chp3_exercise_train.parquet&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;../data/chp3_exercise_test.parquet&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>base_date</th>
      <th>day_of_week</th>
      <th>base_hour</th>
      <th>lane_count</th>
      <th>road_rating</th>
      <th>road_name</th>
      <th>multi_linked</th>
      <th>connect_code</th>
      <th>maximum_speed_limit</th>
      <th>...</th>
      <th>road_type</th>
      <th>start_node_name</th>
      <th>start_latitude</th>
      <th>start_longitude</th>
      <th>start_turn_restricted</th>
      <th>end_node_name</th>
      <th>end_latitude</th>
      <th>end_longitude</th>
      <th>end_turn_restricted</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TRAIN_0000000</td>
      <td>20220623</td>
      <td>목</td>
      <td>17</td>
      <td>1</td>
      <td>106</td>
      <td>지방도1112호선</td>
      <td>0</td>
      <td>0</td>
      <td>60.0</td>
      <td>...</td>
      <td>3</td>
      <td>제3교래교</td>
      <td>33.427747</td>
      <td>126.662612</td>
      <td>없음</td>
      <td>제3교래교</td>
      <td>33.427749</td>
      <td>126.662335</td>
      <td>없음</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>TRAIN_0000001</td>
      <td>20220728</td>
      <td>목</td>
      <td>21</td>
      <td>2</td>
      <td>103</td>
      <td>일반국도11호선</td>
      <td>0</td>
      <td>0</td>
      <td>60.0</td>
      <td>...</td>
      <td>0</td>
      <td>광양사거리</td>
      <td>33.500730</td>
      <td>126.529107</td>
      <td>있음</td>
      <td>KAL사거리</td>
      <td>33.504811</td>
      <td>126.526240</td>
      <td>없음</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>TRAIN_0000002</td>
      <td>20211010</td>
      <td>일</td>
      <td>7</td>
      <td>2</td>
      <td>103</td>
      <td>일반국도16호선</td>
      <td>0</td>
      <td>0</td>
      <td>80.0</td>
      <td>...</td>
      <td>0</td>
      <td>창고천교</td>
      <td>33.279145</td>
      <td>126.368598</td>
      <td>없음</td>
      <td>상창육교</td>
      <td>33.280072</td>
      <td>126.362147</td>
      <td>없음</td>
      <td>61.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TRAIN_0000003</td>
      <td>20220311</td>
      <td>금</td>
      <td>13</td>
      <td>2</td>
      <td>107</td>
      <td>태평로</td>
      <td>0</td>
      <td>0</td>
      <td>50.0</td>
      <td>...</td>
      <td>0</td>
      <td>남양리조트</td>
      <td>33.246081</td>
      <td>126.567204</td>
      <td>없음</td>
      <td>서현주택</td>
      <td>33.245565</td>
      <td>126.566228</td>
      <td>없음</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>TRAIN_0000004</td>
      <td>20211005</td>
      <td>화</td>
      <td>8</td>
      <td>2</td>
      <td>103</td>
      <td>일반국도12호선</td>
      <td>0</td>
      <td>0</td>
      <td>80.0</td>
      <td>...</td>
      <td>0</td>
      <td>애월샷시</td>
      <td>33.462214</td>
      <td>126.326551</td>
      <td>없음</td>
      <td>애월입구</td>
      <td>33.462677</td>
      <td>126.330152</td>
      <td>없음</td>
      <td>38.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 23 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>base_date</th>
      <th>base_hour</th>
      <th>lane_count</th>
      <th>road_rating</th>
      <th>multi_linked</th>
      <th>connect_code</th>
      <th>maximum_speed_limit</th>
      <th>vehicle_restricted</th>
      <th>weight_restricted</th>
      <th>height_restricted</th>
      <th>road_type</th>
      <th>start_latitude</th>
      <th>start_longitude</th>
      <th>end_latitude</th>
      <th>end_longitude</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
      <td>4701217.0</td>
      <td>4.701217e+06</td>
      <td>4701217.0</td>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
      <td>4.701217e+06</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.021672e+07</td>
      <td>1.192820e+01</td>
      <td>1.836651e+00</td>
      <td>1.049585e+02</td>
      <td>4.762597e-04</td>
      <td>2.660218e-01</td>
      <td>6.125329e+01</td>
      <td>0.0</td>
      <td>5.618742e+03</td>
      <td>0.0</td>
      <td>6.152237e-01</td>
      <td>3.338432e+01</td>
      <td>1.265217e+02</td>
      <td>3.338432e+01</td>
      <td>1.265217e+02</td>
      <td>4.278844e+01</td>
    </tr>
    <tr>
      <th>std</th>
      <td>4.555709e+03</td>
      <td>6.722092e+00</td>
      <td>6.877513e-01</td>
      <td>1.840107e+00</td>
      <td>2.181818e-02</td>
      <td>5.227760e+00</td>
      <td>1.213354e+01</td>
      <td>0.0</td>
      <td>1.395343e+04</td>
      <td>0.0</td>
      <td>1.211268e+00</td>
      <td>1.012015e-01</td>
      <td>1.563657e-01</td>
      <td>1.011948e-01</td>
      <td>1.563519e-01</td>
      <td>1.595443e+01</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.021090e+07</td>
      <td>0.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.030000e+02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>3.000000e+01</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>3.324343e+01</td>
      <td>1.261826e+02</td>
      <td>3.324343e+01</td>
      <td>1.261826e+02</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.021110e+07</td>
      <td>6.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.030000e+02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>5.000000e+01</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>3.326422e+01</td>
      <td>1.264232e+02</td>
      <td>3.326422e+01</td>
      <td>1.264232e+02</td>
      <td>3.000000e+01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.022013e+07</td>
      <td>1.200000e+01</td>
      <td>2.000000e+00</td>
      <td>1.060000e+02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>6.000000e+01</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>3.341257e+01</td>
      <td>1.265112e+02</td>
      <td>3.341257e+01</td>
      <td>1.265112e+02</td>
      <td>4.300000e+01</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2.022050e+07</td>
      <td>1.800000e+01</td>
      <td>2.000000e+00</td>
      <td>1.070000e+02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>7.000000e+01</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>3.347804e+01</td>
      <td>1.265840e+02</td>
      <td>3.347804e+01</td>
      <td>1.265840e+02</td>
      <td>5.400000e+01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.022073e+07</td>
      <td>2.300000e+01</td>
      <td>3.000000e+00</td>
      <td>1.070000e+02</td>
      <td>1.000000e+00</td>
      <td>1.030000e+02</td>
      <td>8.000000e+01</td>
      <td>0.0</td>
      <td>5.000000e+04</td>
      <td>0.0</td>
      <td>3.000000e+00</td>
      <td>3.355608e+01</td>
      <td>1.269309e+02</td>
      <td>3.355608e+01</td>
      <td>1.269309e+02</td>
      <td>1.130000e+02</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 4701217 entries, 0 to 4701216
Data columns (total 23 columns):
 #   Column                 Dtype  
---  ------                 -----  
 0   id                     object 
 1   base_date              int64  
 2   day_of_week            object 
 3   base_hour              int64  
 4   lane_count             int64  
 5   road_rating            int64  
 6   road_name              object 
 7   multi_linked           int64  
 8   connect_code           int64  
 9   maximum_speed_limit    float64
 10  vehicle_restricted     float64
 11  weight_restricted      float64
 12  height_restricted      float64
 13  road_type              int64  
 14  start_node_name        object 
 15  start_latitude         float64
 16  start_longitude        float64
 17  start_turn_restricted  object 
 18  end_node_name          object 
 19  end_latitude           float64
 20  end_longitude          float64
 21  end_turn_restricted    object 
 22  target                 float64
dtypes: float64(9), int64(7), object(7)
memory usage: 825.0+ MB
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>결측치 확인</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 코드 작성</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="eda">
<h4>[2] EDA (탐색적 데이터 분석)<a class="headerlink" href="#eda" title="Permalink to this heading">#</a></h4>
<ul>
<li><p>컬럼 설명</p>
<p>base_date,날짜<br />
day_of_week,요일<br />
base_hour,시간대<br />
road_in_use,도로사용여부<br />
lane_count,차로수<br />
road_rating,도로등급<br />
multi_linked,중용구간 여부<br />
connect_code,연결로 코드<br />
maximum_speed_limit,최고속도제한<br />
weight_restricted,통과제한하중<br />
hight_restricted,통과제한높이<br />
road_type,도로유형<br />
start_latitude,시작지점의 위도<br />
start_longitude,시작지점의 경도<br />
start_turn_restricted,시작 지점의 회전제한 유무<br />
end_latitude,도착지점의 위도<br />
end_longitude,도착지점의 경도<br />
end_turn_restricted,도작지점의 회전제한 유무<br />
road_name,도로명<br />
start_node_name,시작지점명<br />
end_node_name,도착지점명<br />
vehicle_restricted,통과제한차량<br />
target,평균속도(km)</p>
</li>
</ul>
<ul class="simple">
<li><p>편의를 위해 아래의 컬럼은 빼고 분석해봅시다</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;multi_linked&#39;</span><span class="p">,</span> <span class="s1">&#39;connect_code&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_restricted&#39;</span><span class="p">,</span> <span class="s1">&#39;height_restricted&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;road_name&#39;</span><span class="p">,</span> <span class="s1">&#39;start_node_name&#39;</span><span class="p">,</span> <span class="s1">&#39;end_node_name&#39;</span><span class="p">,</span> <span class="s1">&#39;vehicle_restricted&#39;</span><span class="p">],</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>각 컬럼이 어떤 분포를 가지고 있는지 시각화 해봅시다</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 코드 작성</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>어떤 변수가 속도에 큰 영향을 미칠까요?  속도와 각 변수들의 상관성을 시각화 해봅시다</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 코드 작성</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>시공간상에서의 속도 시각화</p>
<ul>
<li><p>해당 데이터는 공간정보와 시간정보가 포함되어 있는 시공간 데이터 입니다.</p></li>
<li><p>어떤 방식으로 시각화 하는것이 가장 효율적일까요?</p></li>
<li><p>공간 및 시계열 데이터를 시각화하는데 유용한 아래의 패키지들을 활용해 봅시다</p>
<ul>
<li><p>folium</p></li>
<li><p>plotly</p></li>
<li><p>leaflet</p></li>
<li><p>pydeck</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id8">
<h4>[3] 전처리 파이프라인 구축<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>이제 머신러닝 모델의 학습을 위한 데이터를 가공해 봅시다.</p></li>
<li><p>연속형 변수와 범주형 변수는 구분해서 파이프라인에 넣어주어야 합니다.</p></li>
<li><p>전처리를 할 때, 각 도로에서 제주공항까지의 거리를 계산해주는 트랜스포머를 추가해봅시다</p></li>
<li><p>아래의 class를 활용해 보세요</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#---# 제주공항까지의 거리를 계산해주는 transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>

<span class="k">class</span> <span class="nc">DistanceToAirport</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">airport_lon</span><span class="o">=</span><span class="mf">126.4913534</span><span class="p">,</span> <span class="n">airport_lat</span><span class="o">=</span><span class="mf">33.5104135</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">airport_lon</span> <span class="o">=</span> <span class="n">airport_lon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">airport_lat</span> <span class="o">=</span> <span class="n">airport_lat</span>

    <span class="k">def</span> <span class="nf">haversine_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span><span class="p">):</span>
        <span class="c1"># 경도와 위도를 라디안 단위로 변환</span>
        <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>

        <span class="c1"># Haversine 공식을 사용하여 거리 계산</span>
        <span class="n">dlon</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span>
        <span class="n">dlat</span> <span class="o">=</span> <span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlat</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlon</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mi">6371</span>  <span class="c1"># 지구 반지름 (단위: km)</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">r</span>

        <span class="k">return</span> <span class="n">distance</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X_copy</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">X_copy</span><span class="p">[</span><span class="s1">&#39;distance_to_airport&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">haversine_distance</span><span class="p">(</span><span class="n">X_copy</span><span class="p">[</span><span class="s1">&#39;start_longitude&#39;</span><span class="p">],</span> <span class="n">X_copy</span><span class="p">[</span><span class="s1">&#39;start_latitude&#39;</span><span class="p">],</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">airport_lon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">airport_lat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X_copy</span><span class="p">[[</span><span class="s1">&#39;distance_to_airport&#39;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;distance_to_airport&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id9">
<h4>[4] 모델 학습<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>본인이 원하는 모델을 사용하여 Target 변수를 예측하는 모델을 만들어 봅시다</p></li>
</ul>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ko"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="chapter2.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">2. Data Preparation</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-learning-models">3.1 Machine Learning Models 개요</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">3.1.1 머신러닝을 공부하기 위한 교재 추천</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">3.1.2 도시/교통 분야에서의 머신러닝 응용사례</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#supervised-learning">지도학습 (Supervised Learning)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unsupervised-learning">비지도 학습 (Unsupervised Learning)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eta-estimated-time-of-arrival-models-o-d-based-travel-time-prediction">3.2 ETA (Estimated Time of Arrival) Models (O-D based Travel Time Prediction)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-definitions-for-predicting-estimated-time-of-arrival">3.2.1 Problem Definitions for Predicting Estimated Time of Arrival</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">3.2.2 Data Preparation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda-exploratory-data-analysis">3.2.3 EDA (Exploratory Data Analysis)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">[1] 시간 변수 가공</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">[2] 결측치 확인</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#target">[3] 입력변수들의 분포 및 Target 변수와의 관계 분석</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">[4] 공간 시각화</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">[5] 공간 시각화 기반의 데이터 처리</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">3.2.4 Data Preprocessing (파이프라인 구축)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-model">3.2.5 Construct Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation">3.2.6 Validation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">3.3 Exercise</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-link-based-travel-time-prediction">3.3.1 Construct Link-based Travel Time Prediction</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">[1] 데이터 읽기</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">[2] EDA (탐색적 데이터 분석)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">[3] 전처리 파이프라인 구축</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">[4] 모델 학습</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jiho Yeo
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>