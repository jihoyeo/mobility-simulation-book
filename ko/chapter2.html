

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>2. Data Preparation &#8212; Digital Twin for Urban Mobility Systems</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ko/chapter2';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Models for Predicting Estimated Time of Arrival" href="chapter3.html" />
    <link rel="prev" title="1. Introduction" href="chapter1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Digital Twin for Urban Mobility Systems - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Digital Twin for Urban Mobility Systems - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Urban Mobility Simulation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter1.html">1. Introduction</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. Data Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter3.html">3. Models for Predicting Estimated Time of Arrival</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter4.html">4. 모빌리티 운영을 위한 디지털 트윈 시뮬레이션 구축</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fko/chapter2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/ko/chapter2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>2. Data Preparation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.1 수도권 생활이동 데이터 분석</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.1.1 활용 데이터</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.1.2 데이터 읽기 및 간단한 전처리</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-visualization">2.1.3 Basic visualization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#travel-time-data-taxi-trip-record">2.3 Travel Time Data (Taxi Trip Record)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.3.1 데이터 읽기</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2.3.2 Basic Visualization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#road-network-and-geometry">2.4 Road Network and Geometry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#open-street-map">2.4.1 Open Street Map 데이터 살펴보기</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#open-street-map-osm-pbf">[1] Open Street Map 데이터 취득하기 (.osm.pbf 파일)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#osm">[2] 내가 원하는 지역 osm 지도를 그래프 형태로 표현</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">[3] 여러 네트워크를 한번에 표시</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">[4]  기초적인 도로네트워크 속성 파악 및 시각화</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">2.4.2 최단거리 분석</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#network-distance">[1] 두 지점간 Network Distance 구하기 실습</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">[2] 이동 속도 및 시간 영향을 고려한 경로 산출</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">[3] 특정 노드에서 지정한 거리/시간에 도달할 수 있는 노드 분석( 버퍼 )</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graph">2.4.3 Graph 간소화</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#osmnx">[1] OSMnx에서 제공하는 그래프를 간소화 하는 두가지 함수</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simplify-graph">[2] <code class="docutils literal notranslate"><span class="pre">simplify_graph</span></code> 자세히 살펴보기</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">2.2 스마트카드 데이터 분석</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">2.2.1 활용 데이터</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">2.2.2 시간대별 승하차 패턴 분석</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">2.2.3 역별 승하차 패턴 히트맵 시각화</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">2.2.4 출퇴근 시간대 집중도 분석</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gtfs-general-transit-feed-specification">2.5 GTFS (General Transit Feed Specification)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">2.6 Exercise</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">2.6.1 통행 수요 데이터 분석 및 시각화</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">2.6.2 스마트카드 데이터 분석 및 시각화</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">2.6.3 통행 시간 데이터 분석 및 시각화</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">2.6.4 도로네트워크 분석</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <table align="left">
  <td>
    <a target="_blank" href="https://colab.research.google.com/github/jihoyeo/mobility-simulation-book/blob/main/ko/chapter2.ipynb"><img src="https://www.tensorflow.org/images/colab_logo_32px.png" />구글 코랩에서 실행하기</a>
  </td>
</table>
<br><section class="tex2jax_ignore mathjax_ignore" id="data-preparation">
<h1>2. Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this heading">#</a></h1>
<p>본 챕터에서는 모빌리티 시뮬레이션을 구축하는데 필요한 기본적인 입력데이터들을 살펴본다. 단순히 데이터를 살펴보는데서 끝나지 않고 간단한 데이터의 전처리 및 시각화의 실습과정도 포함하고 있다.</p>
<p>매우 다양한 형태의 모빌리티 데이터가 존재하며, 이들을 분류하는 기준 역시 분석자의 목표에 따라 여려가지로 구분할 수 있지만 본 책에서는 크게 아래와 같은 형태의 데이터를 살펴볼 것이다.</p>
<ol class="arabic simple">
<li><p>통행수요 데이터 (Travel Demand)</p>
<ul class="simple">
<li><p>시뮬레이션을 하기 위한 승객의 수요를 생성하는 기초자료로 활용됨</p></li>
</ul>
</li>
<li><p>통행시간 데이터 (Travel Time)</p>
<ul class="simple">
<li><p>시뮬레이션을 Calibration 하는데 활용</p></li>
<li><p>e.g., 출퇴근 시간의 교통 정체, 새벽시간대의 빠른 속도를 시뮬레이션에 반영 가능함</p></li>
</ul>
</li>
<li><p>도로 네트워크 데이터 (Road Network)</p>
<ul class="simple">
<li><p>도로 위를 움직이는 차량 구현 (Vehicle Router)</p></li>
</ul>
</li>
<li><p>대중교통 네트워크 데이터 (Public Transit Network)</p>
<ul class="simple">
<li><p>버스, 지하철과 같은 노선과 배차간격이 정해진 모빌리티 시스템을 구현하는데 사용</p></li>
</ul>
</li>
</ol>
<section id="id1">
<h2>2.1 수도권 생활이동 데이터 분석<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<section id="id2">
<h3>2.1.1 활용 데이터<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>통행수요는 특정지역에서 출발(Trip Production)하거나, 특정지역으로 도착하는 통행(Trip Attraction) 형태로 존재할 수도 있고, 혹은 더 세분화 한다면 출발지-목적지 단위의 통행수요(Origin-Destination (OD) Travel Demand)로 나타낼 수 있다.</p></li>
<li><p>최근 많은 사람들이 스마트폰을 사용하고 따라서 통신사 기지국 기반으로 세밀한 통행패턴이 수집 가능하며, O-D 단위의 통행수요 데이터를 구득하기가 수월해졌다. 따라서 본 교재에서는 O-D 단위의 통행 데이터를 주로 활용하는 실습을 진행할 예정이다.</p></li>
<li><p>본 예제에서는 서울시에서 제공하는 수도권 생활이동 데이터를 활용하였다.</p>
<ul>
<li><p><a class="reference external" href="https://data.seoul.go.kr/dataVisual/seoul/capitalRegionLivingMigration.do">https://data.seoul.go.kr/dataVisual/seoul/capitalRegionLivingMigration.do</a></p></li>
</ul>
</li>
</ul>
</section>
<section id="id3">
<h3>2.1.2 데이터 읽기 및 간단한 전처리<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>간단한 예제를 위해 서울시에서 제공하는 <a class="reference external" href="https://data.seoul.go.kr/dataVisual/seoul/capitalRegionLivingMigration.do">수도권 생활이동</a> 데이터 중, 2024년 3월 27일 하루치의 데이터만을 예제로 사용하였다.</p></li>
<li><p>원활한 실습을 위해 모든 데이터는 Google Drive에 업로드 하였으며, <code class="docutils literal notranslate"><span class="pre">gdown</span></code> 패키지를 사용해 데이터를 다운로드 받은 후 로드하는 방식을 사용하였다.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">gdown</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">topojson</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tp</span> <span class="c1"># 공간정보를 간소화 해주는 패키지 (분석속도 &amp; 결과물 용량에 영향을 미침)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pydeck</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pdk</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span><span class="w"> </span><span class="nn">gdown</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;gdown&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">download_and_read_parquet</span><span class="p">(</span><span class="n">file_id</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;../data/chp2_od_data_2.parquet&quot;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Google Drive에서 파일 다운로드</span>
        <span class="n">gdown</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">file_id</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="c1"># Parquet 파일을 DataFrame으로 읽기</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
        
        <span class="c1"># 임시 파일 삭제 (데이터 용량이 매우 큰 경우 사용)</span>
        <span class="c1"># os.remove(output_path) # 다운로드 받은 데이터를 삭제하고 싶지 않을 때는 해당 라인을 주석처리</span>
        
        <span class="k">return</span> <span class="n">df</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;오류 발생: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 파일 불러오기</span>
<span class="n">file_id</span> <span class="o">=</span> <span class="s2">&quot;1uJX9MuNX2J6J5SpE-RQy05XPsae6Fg4x&quot;</span> <span class="c1"># 구글 드라이브에 업로드 된 파일의 ID</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">download_and_read_parquet</span><span class="p">(</span><span class="n">file_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading...
From: https://drive.google.com/uc?id=1uJX9MuNX2J6J5SpE-RQy05XPsae6Fg4x
To: e:\book\urban-mobility-simulation\data\chp2_od_data_2.parquet
100%|██████████| 56.6M/56.6M [00:05&lt;00:00, 11.3MB/s]
</pre></div>
</div>
</div>
</div>
<p>인터넷 환경으로 인해 파일을 불러오는게 느리다면, github에서 clone 할 때 가지고 온 data 폴더에 있는 파일을 직접 열 수 있다.<br />
아래 코드를 실행해 보자.</p>
<div class="highlight-code-cell notranslate"><div class="highlight"><pre><span></span>df = pd.read_parquet(&quot;../data/chp2_od_data.parquet&quot;)
</pre></div>
</div>
<p>데이터 자동 로딩 함수를 아래와 같이 구현할 수도 있다.
매번 데이터를 다운로드하는 것은 시간이 오래 걸리므로, 로컬에 파일이 있는지 먼저 확인하고 없을 때만 구글 드라이브에서 다운로드하는 함수를 만들어보자.</p>
<p>이 함수는 다음과 같이 동작합니다:</p>
<ol class="arabic simple">
<li><p>먼저 지정된 경로에 파일이 있는지 확인</p></li>
<li><p>파일이 있으면 로컬 파일을 불러옴</p></li>
<li><p>파일이 없으면 구글 드라이브에서 자동으로 다운로드 후 불러옴</p></li>
</ol>
<p>이렇게 하면 처음에는 다운로드가 필요하지만, 그 다음부터는 로컬 파일을 빠르게 불러올 수 있습니다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_or_download_parquet</span><span class="p">(</span><span class="n">file_id</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="s2">&quot;../data/chp2_od_data_2.parquet&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    로컬 파일이 존재하면 불러오고, 없으면 구글 드라이브에서 다운로드하는 함수</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        file_id (str): 구글 드라이브 파일 ID</span>
<span class="sd">        file_path (str): 로컬 파일 경로</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: 불러온 데이터프레임</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;로컬 파일이 존재합니다: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;로컬 파일을 성공적으로 불러왔습니다.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;로컬 파일이 존재하지 않습니다. 구글 드라이브에서 다운로드합니다.&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">download_and_read_parquet</span><span class="p">(</span><span class="n">file_id</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;구글 드라이브에서 파일을 성공적으로 다운로드하고 불러왔습니다.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

<span class="c1"># 함수를 사용하여 데이터 불러오기</span>
<span class="n">file_id</span> <span class="o">=</span> <span class="s2">&quot;1uJX9MuNX2J6J5SpE-RQy05XPsae6Fg4x&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">load_or_download_parquet</span><span class="p">(</span><span class="n">file_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>컬럼의 명세는 아래와 같다. 행정동 단위의 O-D 통행량 및 통행시간 정보를 제공해주고 있다. 더 상세하게는 내/외국인 구분, 국적, 이동목적과 같은 정보도 제공을 해준다.</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>순번</p></th>
<th class="head"><p>영문 컬럼명</p></th>
<th class="head"><p>컬럼 설명</p></th>
<th class="head"><p>NULL 여부</p></th>
<th class="head"><p>NULL 대체값</p></th>
<th class="head"><p>형식</p></th>
<th class="head"><p>규칙</p></th>
<th class="head"><p>데이터 허용범위</p></th>
<th class="head"><p>비고</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>O_ADMDONG_CD</p></td>
<td><p>출발 행정동</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>STRING</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>행안부 8자리 코드체계</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>D_ADMDONG_CD</p></td>
<td><p>도착 행정동</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>STRING</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>행안부 8자리 코드체계</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>ST_TIME_CD</p></td>
<td><p>출발 시간</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>STRING</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>7-9시/17시-19시는 20분단위, 그 외 1시간 단위</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>FNS_TIME_CD</p></td>
<td><p>도착 시간</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>STRING</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>7-9시/17시-19시는 20분단위, 그 외 1시간 단위</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>IN_FORN_DIV_NM</p></td>
<td><p>내/외국인 구분</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>STRING</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>내국인, 단기외국인, 장기외국인</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>FORN_CITIZ_NM</p></td>
<td><p>국적</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>STRING</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>MOVE_PURPOSE</p></td>
<td><p>이동 목적</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>STRING</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>1: 출근, 2 : 등교, 3: 귀가, 4: 쇼핑, 5: 관광, 6: 병원, 7: 기타</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>MOVE_DIST</p></td>
<td><p>평균 이동 거리(m)</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>DOUBLE</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>MOVE_TIME</p></td>
<td><p>평균 이동 시간(분)</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>DOUBLE</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>CNT</p></td>
<td><p>이동인구 수</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>DOUBLE</p></td>
<td><p>(18,2)</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>ETL_YMD</p></td>
<td><p>기준 년월 일</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>STRING</p></td>
<td><p>yyyyMMdd</p></td>
<td><p>데이터 기준 당일</p></td>
<td><p>-</p></td>
</tr>
</tbody>
</table>
</section>
<section id="basic-visualization">
<h3>2.1.3 Basic visualization<a class="headerlink" href="#basic-visualization" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>통행량 데이터의 경우 출발지/도착지에 대한 공간정보 및 통행시간 정보가 포함된 데이터이다.</p></li>
<li><p>도시/교통 분야의 데이터는 이처럼 시간과 공간의 정보를 동시에 가지고 있는 ‘시공간 데이터’인 경우가 많으며 이를 분석하기 위한 기초적인 분석기술 및 핵심 패키지를 이해하는 것이 중요하다.</p></li>
<li><p>공간데이터를 분석하기 위한 Python 패키지로는 대표적으로 <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>가 있으며, 시각화를 위한 패키지로는 <code class="docutils literal notranslate"><span class="pre">folium</span></code>, <code class="docutils literal notranslate"><span class="pre">plotly</span></code>, <code class="docutils literal notranslate"><span class="pre">pydeck</span></code>이 있다.</p></li>
<li><p>위의 키워드로하여 인터넷 검색을 해보면 다양한 튜토리얼 및 예제 코드가 있으므로 시간을 할애해서 공부하는 것을 추천하며, 본 책에서는 상세히 다루지 않는다.</p></li>
<li><p>아래는 내가 추천하는 시간을 할애해서 공부하면 좋은 자료들이다.</p>
<ul>
<li><p><a class="reference external" href="https://www.kaggle.com/learn/geospatial-analysis">Kaggle 에서 제공해주는 Geospatial Analysis</a></p></li>
<li><p><a class="reference external" href="https://deckgl.readthedocs.io/en/latest/">Pydeck을 활용한 공간데이터 시각화</a></p></li>
<li><p><a class="reference external" href="https://py.geocompx.org/08-mapping">Geocomputation with Python</a></p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>수도권 생활이동 데이터의 경우 행정동 단위로 데이터가 존재하기 때문에 공간상에 시각화를 하기 위해서는 행정동의 geometry 정보를 담고 있는 데이터가 추가로 필요하다.</p></li>
<li><p>본 실습에서는 <a class="github reference external" href="https://github.com/vuski/admdongkor">vuski/admdongkor</a> 에서제공하는 행정동 경계 데이터를 활용하여 간단한 시각화를 수행한다</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">download_and_read_geojson</span><span class="p">(</span><span class="n">file_id</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;../data/chp2_HangJeongDong_ver20230101.geojson&quot;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Google Drive에서 파일 다운로드</span>
        <span class="n">gdown</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">file_id</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="c1"># Parquet 파일을 DataFrame으로 읽기</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span>
        
        <span class="c1"># 임시 파일 삭제 (데이터 용량이 매우 큰 경우 사용)</span>
        <span class="c1"># os.remove(output_path) # 다운로드 받은 데이터를 삭제하고 싶지 않을 때는 해당 라인을 주석처리</span>
        
        <span class="k">return</span> <span class="n">df</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;오류 발생: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### 행정경계 데이터 불러오기</span>
<span class="n">file_id</span> <span class="o">=</span> <span class="s2">&quot;1u8V4h-yUef0g-RJ445wsBgHXpMyUj7ih&quot;</span> <span class="c1"># 구글 드라이브에 업로드 된 파일의 ID</span>
<span class="n">gdf_adm</span> <span class="o">=</span> <span class="n">download_and_read_geojson</span><span class="p">(</span><span class="n">file_id</span><span class="p">)</span>
<span class="c1"># gdf_adm = gpd.read_file(&#39;../data/chp2_HangJeongDong_ver20230101.geojson&#39;, driver=&#39;GeoJSON&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### 서울, 경기, 인천 지역만 추출</span>
<span class="n">gdf_adm</span> <span class="o">=</span> <span class="n">gdf_adm</span><span class="p">[</span><span class="n">gdf_adm</span><span class="p">[</span><span class="s1">&#39;sidonm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;서울특별시&#39;</span><span class="p">,</span> <span class="s1">&#39;경기도&#39;</span><span class="p">,</span> <span class="s1">&#39;인천광역시&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#### 유동인구와 일치하는 행정동코드 컬럼(`adm_cd2`)을 숫자형태로 변환</span>
<span class="n">gdf_adm</span><span class="p">[</span><span class="s1">&#39;adm_cd2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">gdf_adm</span><span class="p">[</span><span class="s1">&#39;adm_cd2&#39;</span><span class="p">])</span>

<span class="c1">#### Divide by 100 and create the new column &#39;ADMDONG_CD&#39;</span>
<span class="n">gdf_adm</span><span class="p">[</span><span class="s1">&#39;ADMDONG_CD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_adm</span><span class="p">[</span><span class="s1">&#39;adm_cd2&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span>

<span class="c1">#### Convert the &#39;ADMDONG_CD&#39; column to integer</span>
<span class="n">gdf_adm</span><span class="p">[</span><span class="s1">&#39;ADMDONG_CD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdf_adm</span><span class="p">[</span><span class="s1">&#39;ADMDONG_CD&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1">#### name, sgg 컬럼만 남기기</span>
<span class="n">gdf_adm</span> <span class="o">=</span> <span class="n">gdf_adm</span><span class="p">[[</span><span class="s1">&#39;adm_nm&#39;</span><span class="p">,</span><span class="s1">&#39;ADMDONG_CD&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_adm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_adm</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### 행정동 데이터 기하구조 간소화</span>
<span class="n">simplified_geometry</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">Topology</span><span class="p">(</span><span class="n">gdf_adm</span><span class="p">,</span> <span class="n">toposimplify</span><span class="o">=</span><span class="mf">.005</span><span class="p">)</span><span class="o">.</span><span class="n">to_gdf</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simplified_geometry</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interactive Map</span>
<span class="n">simplified_geometry</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">tiles</span> <span class="o">=</span> <span class="s1">&#39;CartoDB positron&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### 출발 행정동 및 시간단위로 통행량 aggregation</span>
<span class="n">df_agg</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;O_ADMDONG_CD&#39;</span><span class="p">,</span> <span class="s1">&#39;ST_TIME_CD&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;CNT&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_agg</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. 먼저 pandas의 merge 함수를 사용하여 df_agg를 기준으로 병합</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">simplified_geometry</span><span class="p">,</span> 
                         <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;O_ADMDONG_CD&#39;</span><span class="p">,</span> 
                         <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;ADMDONG_CD&#39;</span><span class="p">,</span> 
                         <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># 2. 병합 결과를 GeoDataFrame으로 변환</span>
<span class="n">vis_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">simplified_geometry</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vis_gdf</span><span class="p">[</span><span class="n">vis_gdf</span><span class="p">[</span><span class="s1">&#39;ST_TIME_CD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;CNT&#39;</span><span class="p">,</span> 
                                            <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> 
                                            <span class="n">tiles</span><span class="o">=</span><span class="s1">&#39;CartoDB positron&#39;</span><span class="p">,</span>
                                            <span class="n">style_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fillOpacity&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="travel-time-data-taxi-trip-record">
<h2>2.3 Travel Time Data (Taxi Trip Record)<a class="headerlink" href="#travel-time-data-taxi-trip-record" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>지금까지는 통행량 데이터를 살펴보았습니다. 이 장에서는 통행시간 데이터를 살펴봅니다.</p></li>
<li><p>스마트카드(지하철,버스), 택시 탑승 및 호출 이력, 스마트폰 GPS 데이터 등 다양한 경로를 통해 여러분들의 이동 데이터가 수집되고 있습니다.</p></li>
<li><p>그 중 택시 데이터는 승차와 하차의 정확한 위치와 시간을 알 수 있다는 점에서 데이터의 신뢰성이 높습니다.</p></li>
<li><p>다양한 국가에서 이미 표준화된 형태의 택시 승하차 데이터를 공개하고 있습니다.</p>
<ul>
<li><p><a class="reference external" href="https://www.kaggle.com/competitions/nyc-taxi-trip-duration/data">Ney York City Taxi Trip Duration Data</a></p></li>
<li><p><a class="reference external" href="https://data.cityofchicago.org/Transportation/Taxi-Trips-2013-2023-/wrvz-psew/about_data">Chicago Taxi Trips data</a></p></li>
</ul>
</li>
<li><p>본 장에서는 서울의 택시 승하차 이력 데이터를 살펴보겠습니다. 다만, 국내의 경우 택시승하차 데이터가 오픈되어있지 않으므로, 여기선 가상의 데이터를 활용합니다.</p>
<ul>
<li><p>본 실습 데이터는 실제 데이터가 아니며, 분석을 위해 랜덤하게 생생된 1일치의 데이터입니다.</p></li>
<li><p>국내도 데이터 개방이 더 활성화 되어, 미국의 주요도시처럼 택시 및 스마트카드 데이터가 공개되는 날이 오기를 희망합니다.</p></li>
</ul>
</li>
</ul>
<section id="id4">
<h3>2.3.1 데이터 읽기<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">download_and_read_parquet</span><span class="p">(</span><span class="n">file_id</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;../data/chp2_tx_data_generated.parquet&quot;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Google Drive에서 파일 다운로드</span>
        <span class="n">gdown</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">file_id</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="c1"># Parquet 파일을 DataFrame으로 읽기</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
        
        <span class="c1"># 임시 파일 삭제 (데이터 용량이 매우 큰 경우 사용)</span>
        <span class="c1"># os.remove(output_path) # 다운로드 받은 데이터를 삭제하고 싶지 않을 때는 해당 라인을 주석처리</span>
        
        <span class="k">return</span> <span class="n">df</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;오류 발생: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 파일 불러오기</span>
<span class="n">file_id</span> <span class="o">=</span> <span class="s2">&quot;1uJj-C_7pTkcRk8p5lYah-9Fp660OvS4b&quot;</span> <span class="c1"># 구글 드라이브에 업로드 된 파일의 ID</span>
<span class="n">tx_data</span> <span class="o">=</span> <span class="n">download_and_read_parquet</span><span class="p">(</span><span class="n">file_id</span><span class="p">)</span>
<span class="c1"># tx_data = pd.read_parquet(&#39;../data/chp2_tx_data_generated.parquet&#39;)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>데이터의 시간 형식이 숫자형태로 되어있다. 이렇게 되어있을 경우 보기가 불편하고, 시간단위 연산이 어렵기 때문에 시간 타입의 데이터로 변환해주는 것이 좋다</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 시간 데이터 형식 변횐</span>
<span class="n">tx_data</span><span class="p">[</span><span class="s1">&#39;RIDE_DTIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">tx_data</span><span class="p">[</span><span class="s1">&#39;RIDE_DTIME&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
<span class="n">tx_data</span><span class="p">[</span><span class="s1">&#39;ALIGHT_DTIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">tx_data</span><span class="p">[</span><span class="s1">&#39;ALIGHT_DTIME&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>

<span class="c1"># 통행시간 계산</span>
<span class="n">tx_data</span><span class="p">[</span><span class="s1">&#39;TRAVEL_TIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tx_data</span><span class="p">[</span><span class="s1">&#39;ALIGHT_DTIME&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tx_data</span><span class="p">[</span><span class="s1">&#39;RIDE_DTIME&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tx_data</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h3>2.3.2 Basic Visualization<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>통행량 데이터와 마찬가지로 간단한 시각화를 해보자.</p></li>
<li><p>다음과 같은 오픈소스를 활용한다면 매끄럽게 시각화가 가능하다.</p>
<ul>
<li><p><a class="reference external" href="https://kepler.gl/">https://kepler.gl/</a></p></li>
<li><p>데이터를 csv로 저장한 후, Kepler를 통해 시각화를 해보자.</p></li>
<li><p><a class="reference external" href="https://kepler.gl/demo/map?mapUrl=https://dl.dropboxusercontent.com/scl/fi/8k0y58t4rceqvslmvhwyl/keplergl_7sjanmo.json?rlkey=8d6d24vw7l63t2bsch5cd53m9&amp;dl=0">예시</a></p></li>
</ul>
</li>
<li><p>통행시간의 경우 출발지-목적지(O-D) 단위로 통행시간을 시각화 하는 연습도 해보자.</p>
<ul>
<li><p>O-D 단위의 시각화의 경우 무수히 많은 O-D pairs가 존재하기 때문에 시각적으로 표현하기가 매우 어렵다.</p></li>
<li><p>또한, 지금 데이터의 공간단위가 이전에 다뤘던 행정구역과 같이 합산된 공간단위가 아니라, 세밀한 위경도 좌표로 표현되어 있기 때문에 더 어렵다.</p></li>
<li><p>위와 같은 문제들을 어떻게 해결할 수 있을까?</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tx_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../data/tx_data_generated.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="road-network-and-geometry">
<h2>2.4 Road Network and Geometry<a class="headerlink" href="#road-network-and-geometry" title="Permalink to this heading">#</a></h2>
<section id="open-street-map">
<h3>2.4.1 Open Street Map 데이터 살펴보기<a class="headerlink" href="#open-street-map" title="Permalink to this heading">#</a></h3>
<p><a class="reference external" href="https://osm.kr/usage/">오픈스트리트맵 한국</a>에서는 대한민국의 OSM을 이용하는 상세한 방법에 대한 메뉴얼을 제공해주고 있다. 상세한 내용은 이곳을 참고하면 되며, 본 장에서는 한국의 OSM 데이터를 불러와서 <code class="docutils literal notranslate"><span class="pre">OSMnx</span></code> 패키지로 간략히 분석하고 시각화 하는 작업을 진행한다.</p>
<ul class="simple">
<li><p>OSM을 이용해서 수도권 지역의 도로 데이터를 가져오고, 시각화 하는 작업을 수행한다</p></li>
<li><p>OSMnx 이용해서 그래프 분석하고, 복잡한 그래프를 간소화 하는 작업을 실습한다</p></li>
</ul>
<section id="open-street-map-osm-pbf">
<h4>[1] Open Street Map 데이터 취득하기 (.osm.pbf 파일)<a class="headerlink" href="#open-street-map-osm-pbf" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>사이트 : <a class="reference external" href="https://download.geofabrik.de/asia.html">https://download.geofabrik.de/asia.html</a></p></li>
<li><p>South Korea 부분의 .osm.pbf 버튼 클릭</p></li>
<li><p>여기서 다운로드 받은 .osm.pbf 파일은 본 챕터에서는 사용하지 않지만 향후 Vehicle Router를 만들 때 활용한다.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">osmnx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ox</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">folium</span>

<span class="n">ox</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">use_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log_console</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ox</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="osm">
<h4>[2] 내가 원하는 지역 osm 지도를 그래프 형태로 표현<a class="headerlink" href="#osm" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>본 실습에서는 <code class="docutils literal notranslate"><span class="pre">OSMnx</span></code> 패키지를 사용하여 원하는 도시의 Graph를 Python으로 가져와서 분석하는 실습을 진행한다.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get a graph for some city</span>
<span class="c1"># www.openstreetmap.org에서 검색 결과가 city-state-country 단위로 나와야 함 </span>

<span class="c1"># # 서울특별시 전체 도로 네트워크 불러오기</span>
<span class="c1"># G = ox.graph_from_place(&#39;서울특별시, 대한민국&#39;, network_type=&#39;drive&#39;)</span>

<span class="c1"># osmnx 그래프 생성( osm 지도 다운로드 )</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_place</span><span class="p">(</span><span class="s1">&#39;성남시, 경기도, 대한민국&#39;</span><span class="p">,</span> <span class="n">network_type</span><span class="o">=</span><span class="s1">&#39;drive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">network_type='drive'</span></code>는 도로 네트워크(차량이 다닐 수 있는 도로)만을 가져오는 옵션이다. 따라서 보행자 도로, 자전거 도로, 또는 작은 골목 등은 포함되지 않을 수 있다. 전체적인 도로와 교통 네트워크를 모두 포함하려면 다른 network_type을 사용할 수 있다.</p>
<p>OSMnx에서 제공하는 네트워크 타입 옵션들은 다음과 같다.</p>
<ul class="simple">
<li><p>‘all’: 모든 도로 네트워크를 가져온다 (자동차, 자전거, 보행자 도로 등 포함)</p></li>
<li><p>‘all_private’: 모든 도로 네트워크(사유지 도로 포함)</p></li>
<li><p>‘bike’: 자전거 네트워크만 가져온다</p></li>
<li><p>‘walk’: 보행자 네트워크만 가져온다</p></li>
<li><p>‘drive’: 차량이 다니는 도로만 가져온다</p></li>
<li><p>‘drive_service’: 서비스 도로(차량 진입 가능하지만 주요 도로는 아님)도 포함</p></li>
</ul>
<p>전체 네트워크를 가져오려면 다음과 같이 사용할 수 있다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_place</span><span class="p">(</span><span class="s1">&#39;성남시, 경기도, 대한민국&#39;</span><span class="p">,</span> <span class="n">network_type</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## 간단한 시각화</span>
<span class="c1"># fig, ax = ox.plot_graph(G)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span>
                            <span class="n">G</span><span class="p">,</span> 
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
                            <span class="n">node_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                            <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.5</span>
                        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>하지만 위와 같이 시각화를 한다면, static map이기 때문에 원하는 특정 지역을 세밀하게 관찰하기가 어렵다.</p></li>
<li><p>Interactive Map을 사용하면 속도는 더 느리지만, 보다 상세히 그래프를 살펴볼 수 있다.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 그래프의 중심점 계산</span>
<span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="s1">&#39;성남시, 경기도, 대한민국&#39;</span><span class="p">)</span>

<span class="c1"># folium 맵 생성</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s1">&#39;cartodbpositron&#39;</span><span class="p">)</span>

<span class="c1"># 엣지(도로) 추가</span>
<span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="p">[(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])]</span>
    
    <span class="c1"># 엣지(street) 정보 생성</span>
    <span class="n">edge_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;도로명: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;길이: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m&lt;br&gt;&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;도로 유형: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;highway&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="n">folium</span><span class="o">.</span><span class="n">PolyLine</span><span class="p">(</span>
        <span class="n">locations</span><span class="o">=</span><span class="n">locations</span><span class="p">,</span>
        <span class="n">weight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="n">edge_info</span>
    <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># 노드(교차점) 추가</span>
<span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># 노드에 연결된 엣지 수 계산</span>
    <span class="n">degree</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    
    <span class="c1"># 노드 정보 생성</span>
    <span class="n">node_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node ID: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;위도: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;경도: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;연결된 도로 수: </span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="n">folium</span><span class="o">.</span><span class="n">CircleMarker</span><span class="p">(</span>
        <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span>
        <span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">popup</span><span class="o">=</span><span class="n">node_info</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fillColor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Node ID: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># 맵 저장</span>
<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;../data/Sungnam_road_network_vis.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>한가지 이상한 점이 있다. 모든 Egde가 직선으로표현되어, 실제 Basemap에 있는 도로와 정확하게 매칭되지 않는다</p></li>
<li><p>Open Steet Map의 edge는 도로의 geometry 정보를 포함하고 있으며, 이 정보를 사용하면 실제도로와 유사하게 시각화가 가능하다</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># folium 맵 생성 (CARTODB positron 베이스맵 사용)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s1">&#39;cartodbpositron&#39;</span><span class="p">)</span>

<span class="c1"># 엣지(도로) 추가</span>
<span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;geometry&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="c1"># 실제 도로 지오메트리 사용</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 지오메트리 정보가 없는 경우 직선으로 표시</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])]</span>
    
    <span class="c1"># 엣지(street) 정보 생성</span>
    <span class="n">edge_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;도로명: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;길이: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m&lt;br&gt;&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;도로 유형: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;highway&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="n">folium</span><span class="o">.</span><span class="n">PolyLine</span><span class="p">(</span>
        <span class="n">locations</span><span class="o">=</span><span class="n">locations</span><span class="p">,</span>
        <span class="n">weight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="n">edge_info</span>
    <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># 노드(교차점) 추가</span>
<span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># 노드에 연결된 엣지 수 계산</span>
    <span class="n">degree</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    
    <span class="c1"># 노드 정보 생성</span>
    <span class="n">node_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node ID: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;위도: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;경도: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;연결된 도로 수: </span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="n">folium</span><span class="o">.</span><span class="n">CircleMarker</span><span class="p">(</span>
        <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span>
        <span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">popup</span><span class="o">=</span><span class="n">node_info</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fillColor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="n">fillOpacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Node ID: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># 맵 저장</span>
<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;../data/Sungnam_road_network_vis_with_geometry.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>위 HTML 파일을 열어서 한번 살펴보자. <code class="docutils literal notranslate"><span class="pre">Folium</span></code>은 Leaflet.js 기반으로 HTML을 생성하고 이를 웹페이지로 렌더링한다.<br />
지도를 그리거나 데이터를 시각화할 때 매번 HTML 파일을 업데이트하거나 렌더링해야 하기 때문에 시간이 더 소요될 수 있습니다.</p>
<p>데이터가 매우 크고, 수가 많을 경우 GPU 가속을 활용하는 시각화 패키지나 툴을 이용하는 것이 도움이 된다.<br />
베이스 맵의 경우 <a class="reference external" href="https://www.mapbox.com/%EC%97%90%EC%84%9C">https://www.mapbox.com/에서</a> 직접 커스터마이즈 하면 된다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pydeck</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pdk</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># 엣지(도로) 데이터 생성</span>
<span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;geometry&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;start_lat&#39;</span><span class="p">:</span> <span class="n">locations</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;start_lon&#39;</span><span class="p">:</span> <span class="n">locations</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;end_lat&#39;</span><span class="p">:</span> <span class="n">locations</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;end_lon&#39;</span><span class="p">:</span> <span class="n">locations</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">),</span>
            <span class="s1">&#39;length&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;highway&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;highway&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
        <span class="p">})</span>

<span class="n">edges_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

<span class="c1"># 노드(교차점) 데이터 생성</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span>
        <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>
        <span class="s1">&#39;node_id&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span>
        <span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="p">})</span>

<span class="n">nodes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>

<span class="c1"># Pydeck의 LineLayer와 ScatterplotLayer 설정</span>
<span class="n">edge_layer</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span>
    <span class="s2">&quot;LineLayer&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">edges_df</span><span class="p">,</span>
    <span class="n">get_source_position</span><span class="o">=</span><span class="s1">&#39;[start_lon, start_lat]&#39;</span><span class="p">,</span>
    <span class="n">get_target_position</span><span class="o">=</span><span class="s1">&#39;[end_lon, end_lat]&#39;</span><span class="p">,</span>
    <span class="n">get_color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
    <span class="n">get_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">pickable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">auto_highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;도로명: </span><span class="si">{name}</span><span class="s2">&lt;br&gt;길이: </span><span class="si">{length}</span><span class="s2"> m&lt;br&gt;도로 유형: </span><span class="si">{highway}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">node_layer</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span>
    <span class="s2">&quot;ScatterplotLayer&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">nodes_df</span><span class="p">,</span>
    <span class="n">get_position</span><span class="o">=</span><span class="s1">&#39;[lon, lat]&#39;</span><span class="p">,</span>
    <span class="n">get_fill_color</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">get_radius</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">pickable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">auto_highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;Node ID: </span><span class="si">{node_id}</span><span class="s2">&lt;br&gt;연결된 도로 수: </span><span class="si">{degree}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Pydeck View 설정</span>
<span class="n">view_state</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">ViewState</span><span class="p">(</span>
    <span class="n">latitude</span><span class="o">=</span><span class="n">center_lat</span><span class="p">,</span>
    <span class="n">longitude</span><span class="o">=</span><span class="n">center_lon</span><span class="p">,</span>
    <span class="n">zoom</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">bearing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">pitch</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="c1"># Pydeck 맵 렌더링</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">pdk</span><span class="o">.</span><span class="n">Deck</span><span class="p">(</span>
    <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="n">edge_layer</span><span class="p">,</span> <span class="n">node_layer</span><span class="p">],</span>
    <span class="n">initial_view_state</span><span class="o">=</span><span class="n">view_state</span>
<span class="p">)</span>

<span class="c1"># 맵 저장</span>
<span class="n">r</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="s2">&quot;../data/Sungnam_road_network_vis_with_pydeck.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h4>[3] 여러 네트워크를 한번에 표시<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 여러 위치에서 네트워크를 생성하기 위한 서울 지역 리스트 설정</span>
<span class="n">places</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;성남시, 경기도, 대한민국&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;송파구, 서울특별시, 대한민국&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;하남시, 경기도, 대한민국&#39;</span><span class="p">,</span>  
<span class="p">]</span>

<span class="c1"># retain_all=True를 사용하여 모든 연결되지 않은 서브그래프도 유지 (연속된 네트워크가 아닌 경우에도 유지)</span>
<span class="c1"># 여러 장소를 기반으로 차량 도로 네트워크(network_type=&quot;drive&quot;)를 생성</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_place</span><span class="p">(</span><span class="n">places</span><span class="p">,</span> <span class="n">network_type</span><span class="o">=</span><span class="s2">&quot;drive&quot;</span><span class="p">,</span> <span class="n">retain_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># 생성된 네트워크 시각화 </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span>
    <span class="n">G</span><span class="p">,</span>                      
    <span class="n">node_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>           
    <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;#FFFF5C&quot;</span><span class="p">,</span>    
    <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.25</span>      
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id7">
<h4>[4]  기초적인 도로네트워크 속성 파악 및 시각화<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># osmnx 그래프 생성( osm 지도 다운로드 )</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_place</span><span class="p">(</span><span class="s1">&#39;성남시, 경기도, 대한민국&#39;</span><span class="p">,</span> <span class="n">network_type</span><span class="o">=</span><span class="s1">&#39;drive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 기본 그래프 정보 출력</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;노드 수:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;엣지 수:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">OSMnx</span></code> 패키지에 있는 <code class="docutils literal notranslate"><span class="pre">basic_stats</span></code>라는 함수를 사용하면 기본적인 네트워크 통계를 출력해준다. 아래와 같은 정보들이 포함된다.</p>
<ul class="simple">
<li><p><strong>n: 그래프의 총 노드 수</strong></p></li>
<li><p><strong>m: 그래프의 총 엣지 수</strong></p></li>
<li><p><strong>k_avg: 평균 노드 차수 (한 노드에 연결된 평균 엣지 수)</strong></p></li>
<li><p><strong>edge_length_total: 모든 엣지 길이의 총합 (미터 단위)</strong></p></li>
<li><p>edge_length_avg: 평균 엣지 길이 (미터 단위)</p></li>
<li><p><strong>streets_per_node_avg: 노드당 평균 Street 수</strong></p></li>
<li><p>streets_per_node_counts: 각 Street수별 노드 개수 (예: 3개의 거리가 만나는 교차로의 수)</p></li>
<li><p>streets_per_node_proportions: 각 Street 수별 노드 비율</p></li>
<li><p><strong>intersection_count: 교차로의 총 개수</strong></p></li>
<li><p><strong>street_length_total: 모든 거리의 총 길이 (미터 단위)</strong></p></li>
<li><p><strong>street_segment_count: 거리 세그먼트의 총 개수</strong></p></li>
<li><p>street_length_avg: 평균 Street 길이 (미터 단위)</p></li>
<li><p>circuity_avg: 평균 우회도 (직선 거리 대비 실제 거리의 비율)</p></li>
<li><p>self_loop_proportion: 자기 루프(같은 노드로 시작하고 끝나는 엣지)의 비율</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 기본 네트워크 통계 계산 및 출력</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">basic_stats</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">기본 네트워크 통계:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>보다 세부적으로 Node와 Edge들이 어떤 속성을 가지고 있는지 알아보자.<br />
기본적으로 Graph의 Node와 Edge는 ~~~ 형태의 데이터 포맷을 가지고 있다. Python에서 보다 쉽게 이를 보기 위해서 Dataframe으로 변환하면 좋다.</p>
<p>Node의 속성:</p>
<ul class="simple">
<li><p>Node ID: 노드의 고유 식별자 (일반적으로 OSM의 ID)</p></li>
<li><p>x, y 좌표: 노드의 경도(longitude, x)와 위도(latitude, y)</p></li>
<li><p>기타 속성: 노드가 속한 구역의 정보 등 다양한 부가 정보가 포함될 수 있습니다.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 처음 20개의 노드만 선택</span>
<span class="n">sample_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">))[:</span><span class="mi">20</span><span class="p">]</span>

<span class="c1"># 각 노드의 특성을 딕셔너리 리스트로 변환</span>
<span class="n">node_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">sample_nodes</span><span class="p">:</span>
    <span class="n">node_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;node_id&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">}</span>  <span class="c1"># 노드의 고유 ID 추가</span>
    <span class="n">node_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># 노드의 기타 속성 추가 (x, y 좌표 등)</span>
    <span class="n">node_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_info</span><span class="p">)</span>

<span class="c1"># DataFrame으로 변환</span>
<span class="n">node_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">node_data</span><span class="p">)</span>
<span class="n">node_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 모든 node의 데이터를 가져옴</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># node에서 highway 속성만을 추출하여 리스트 생성</span>
<span class="n">highway_types</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;highway&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">highway_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;highway&#39;</span><span class="p">])</span>  <span class="c1"># highway 속성이 있으면 리스트에 추가</span>

<span class="c1"># highway 타입별 개수 세기</span>
<span class="n">highway_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">highway_types</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">highway_counts</span>
</pre></div>
</div>
</div>
</div>
<p>Edge의 속성:</p>
<ul class="simple">
<li><p>start_node, end_node: edge가 연결하는 두 노드의 ID</p></li>
<li><p>length: edge의 길이 (단위는 보통 미터)</p></li>
<li><p>highway type: 도로 유형 (예: residential, primary 등)</p></li>
<li><p>geometry: 도로의 곡선 정보 (라인스트링 형태로 저장)</p></li>
<li><p>oneway: 도로가 일방통행인지 여부</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 처음 5개의 엣지만 선택</span>
<span class="n">sample_edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">))[:</span><span class="mi">20</span><span class="p">]</span>

<span class="c1"># 각 엣지의 특성을 딕셔너리 리스트로 변환</span>
<span class="n">edge_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">sample_edges</span><span class="p">:</span>
    <span class="n">edge_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;start_node&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;end_node&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>
    <span class="n">edge_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">edge_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_info</span><span class="p">)</span>

<span class="c1"># DataFrame으로 변환</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">edge_data</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<p>OSM에서 도로 타입이 총 몇가지로 구분이 되는지 알아보려면 아래와 같이 할 수 있다.<br />
매우 많은 도로유형이 있는 것을 알 수 있다. 각각의 상세한 설명 및 기준이 궁금하면 다음을 참고하자. <a class="reference external" href="https://wiki.openstreetmap.org/wiki/Key:highway">https://wiki.openstreetmap.org/wiki/Key:highway</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 모든 edge의 데이터를 가져옴</span>
<span class="n">edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># highway 속성만을 추출하여 리스트 생성</span>
<span class="n">highway_types</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;highway&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="c1"># 일부 엣지의 highway 속성이 리스트일 수 있어 처리</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;highway&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">highway_types</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;highway&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">highway_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;highway&#39;</span><span class="p">])</span>

<span class="c1"># highway 타입별 개수 세기</span>
<span class="n">highway_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">highway_types</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">highway_counts</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id8">
<h3>2.4.2 최단거리 분석<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>두 지점까지의 거리를 추출하는 것은 교통 데이터를 분석할 때 매우 빈번히 쓰인다</p></li>
<li><p>가장 간단한 것은 직선거리를 추출하는 것이지만, 실제 도로위를 움직이는 차량이나 사람의 움직임과는 큰 차이를 보인다.</p></li>
</ul>
<section id="network-distance">
<h4>[1] 두 지점간 Network Distance 구하기 실습<a class="headerlink" href="#network-distance" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">folium</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pip install scikit-learn</span>
<span class="c1"># pip install folium</span>
<span class="c1"># pip install scipy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 원하는 지역 그래프 생성</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_place</span><span class="p">(</span><span class="s1">&#39;동대문구, 서울, 대한민국&#39;</span><span class="p">,</span> <span class="n">network_type</span><span class="o">=</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># 그래프 시각화</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span>
                            <span class="n">G</span><span class="p">,</span> 
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                            <span class="n">node_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                            <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.5</span>
                        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert graph to GeoDataFrames</span>
<span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_to_gdfs</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edges</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 출발지 도착지 좌표 설정( 좌표와 가장 가까운 노드를 찾아줌 )</span>
<span class="n">orig_node</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">nearest_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="mf">127.0462200</span><span class="p">,</span> <span class="mf">37.5804100</span><span class="p">)</span> <span class="c1">#청량리역</span>
<span class="n">dest_node</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">nearest_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="mf">127.0114887</span><span class="p">,</span> <span class="mf">37.5718616</span><span class="p">)</span> <span class="c1">#동대문역</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 최단 거리 경로 추출</span>
<span class="n">route</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">orig_node</span><span class="p">,</span> <span class="n">dest_node</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>

<span class="c1"># Create a GeoDataFrame for the route</span>
<span class="n">route_gdf</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">route_to_gdf</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 최단 거리 추출</span>
<span class="nb">len</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">orig_node</span><span class="p">,</span> <span class="n">dest_node</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;킬로미터&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a map centered on the mean coordinates of the route</span>
<span class="n">center_lat</span> <span class="o">=</span> <span class="n">route_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">center_lon</span> <span class="o">=</span> <span class="n">route_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">tiles</span> <span class="o">=</span> <span class="s1">&#39;cartodbpositron&#39;</span><span class="p">)</span>

<span class="c1"># Add the route to the map</span>
<span class="n">route_gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Add markers for origin and destination</span>
<span class="n">orig_node_xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">orig_node</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">orig_node</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
<span class="n">dest_node_xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">dest_node</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">dest_node</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>

<span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">orig_node_xy</span><span class="p">,</span> <span class="n">popup</span><span class="o">=</span><span class="s1">&#39;출발지&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">dest_node_xy</span><span class="p">,</span> <span class="n">popup</span><span class="o">=</span><span class="s1">&#39;목적지&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Display the map</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id9">
<h4>[2] 이동 속도 및 시간 영향을 고려한 경로 산출<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">G</span> <span class="pre">=</span> <span class="pre">ox.add_edge_speeds(G)</span></code></p>
<p>이 함수는 그래프의 모든 엣지(도로 구간)에 예상 속도를 부여한다. OSMnx는 도로 유형, 속도 제한 등의 OpenStreetMap 데이터를 기반으로 각 도로 구간의 예상 속도를 추정한다. 만약 특정 도로에 대한 속도 정보가 없다면, 도로 유형에 따른 기본값을 사용한다. 이 함수 실행 후, 각 엣지에는 ‘speed’ 속성이 추가된다 (단위: km/h).</p>
<p><code class="docutils literal notranslate"><span class="pre">G</span> <span class="pre">=</span> <span class="pre">ox.add_edge_travel_times(G)</span></code></p>
<p>이 함수는 앞서 추가된 속도 정보와 도로 길이를 사용하여 각 엣지의 이동 시간을 계산한다.
계산식은 기본적으로 “시간 = 거리 / 속도”이다.
이 함수 실행 후, 각 엣지에는 ‘travel_time’ 속성이 추가된다 (단위: 초).</p>
<p>이 두 함수를 순서대로 실행함으로써, 그래프의 각 도로 구간(엣지)에 대해 다음과 같은 정보를 얻게 된다.</p>
<ul class="simple">
<li><p>예상 주행 속도 (km/h)</p></li>
<li><p>예상 이동 시간 (초)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 위의 그래프의 모든 엣지에 속도를 부여</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">add_edge_speeds</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

<span class="c1"># 모든 에지에 대한 이동 시간(초) 계산</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">add_edge_travel_times</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 도로 유형별 평균 속도/시간 값 보기</span>
<span class="n">edges</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_to_gdfs</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># edges[&quot;highway&quot;] = edges[&quot;highway&quot;].astype(str)</span>
<span class="n">edges</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">)[[</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_kph&quot;</span><span class="p">,</span> <span class="s2">&quot;travel_time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 도로 별 속도 지정</span>
<span class="n">hwy_speeds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;residential&quot;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span> <span class="s2">&quot;secondary&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;tertiary&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">}</span> <span class="c1"># residential : 주거지도로 secondary : 지방도 tertiary: 시도·군도·구도</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">add_edge_speeds</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">hwy_speeds</span><span class="o">=</span><span class="n">hwy_speeds</span><span class="p">)</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">add_edge_travel_times</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 도로 유형별 평균 속도/시간 값 보기</span>
<span class="n">edges</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_to_gdfs</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># edges[&quot;highway&quot;] = edges[&quot;highway&quot;].astype(str)</span>
<span class="n">edges</span><span class="o">.</span><span class="n">speed_kph</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 이동 거리와 이동 시간을 최소화한 두 가지 경로를 계산합니다</span>

<span class="c1"># 그래프 내에서 출발지 목적지 가져오기</span>
<span class="n">orig</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">dest</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="p">)[</span><span class="mi">111</span><span class="p">]</span>
<span class="n">route1</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;length&quot;</span><span class="p">)</span>
<span class="n">route2</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;travel_time&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 시각화</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph_routes</span><span class="p">(</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">routes</span><span class="o">=</span><span class="p">[</span><span class="n">route1</span><span class="p">,</span> <span class="n">route2</span><span class="p">],</span> <span class="n">route_colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">route_linewidth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 두 경로 비교</span>

<span class="c1"># route1의 길이 계산 (거리 기준 최적 경로의 총 길이, 단위: 미터)</span>
<span class="n">route1_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ox</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">route_to_gdf</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;length&quot;</span><span class="p">)[</span><span class="s2">&quot;length&quot;</span><span class="p">]))</span>

<span class="c1"># route2의 길이 계산 (시간 기준 최적 경로의 총 길이, 단위: 미터)</span>
<span class="n">route2_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ox</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">route_to_gdf</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route2</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;travel_time&quot;</span><span class="p">)[</span><span class="s2">&quot;length&quot;</span><span class="p">]))</span>

<span class="c1"># route1의 소요 시간 계산 (거리 기준 최적 경로의 총 소요 시간, 단위: 초)</span>
<span class="n">route1_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ox</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">route_to_gdf</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;length&quot;</span><span class="p">)[</span><span class="s2">&quot;travel_time&quot;</span><span class="p">]))</span>

<span class="c1"># route2의 소요 시간 계산 (시간 기준 최적 경로의 총 소요 시간, 단위: 초)</span>
<span class="n">route2_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ox</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">route_to_gdf</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route2</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;travel_time&quot;</span><span class="p">)[</span><span class="s2">&quot;travel_time&quot;</span><span class="p">]))</span>

<span class="c1"># 두 경로의 길이와 소요 시간을 출력</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Route 1 is&quot;</span><span class="p">,</span> <span class="n">route1_length</span><span class="p">,</span> <span class="s2">&quot;meters and takes&quot;</span><span class="p">,</span> <span class="n">route1_time</span><span class="p">,</span> <span class="s2">&quot;seconds.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Route 2 is&quot;</span><span class="p">,</span> <span class="n">route2_length</span><span class="p">,</span> <span class="s2">&quot;meters and takes&quot;</span><span class="p">,</span> <span class="n">route2_time</span><span class="p">,</span> <span class="s2">&quot;seconds.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id10">
<h4>[3] 특정 노드에서 지정한 거리/시간에 도달할 수 있는 노드 분석( 버퍼 )<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h4>
<p>OSMnx 패키지를 사용하면 도로 네트워크에서 특정 시작점으로부터 일정 거리 또는 시간 내에 도달할 수 있는 영역을 식별하는 데도 활용할 수 있다. 이러한 방법은 주로, 어떤 시설이 주변에 얼마나 영향을 미치는지 분석하거나 접근성을 분석하는데 주로 쓰인다. 아래 코드는 강남구의 도로 네트워크에서 특정 노드를 중심으로 1000m 반경 내의 서브그래프를 추출하고 시각화하는 예제이다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 도로 네트워크 불러오기</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_place</span><span class="p">(</span><span class="s1">&#39;Gangnam, Seoul, South Korea&#39;</span><span class="p">,</span> <span class="n">network_type</span><span class="o">=</span><span class="s1">&#39;drive&#39;</span><span class="p">)</span>

<span class="c1"># 특정 노드를 선택 (예: 첫 번째 노드를 선택)</span>
<span class="n">center_node</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># 특정 노드를 중심으로 반경 500m 내의 서브그래프를 ego_graph로 추출</span>
<span class="n">radius</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># 반경 (미터 단위)</span>
<span class="n">ego_G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">ego_graph</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">center_node</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 서브그래프를 시각화</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">ego_G</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># 중심 노드의 좌표 얻기</span>
<span class="n">center_node_coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">center_node</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">center_node</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>

<span class="c1"># 중심 노드를 붉은색으로 표시</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">center_node_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">center_node_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="graph">
<h3>2.4.3 Graph 간소화<a class="headerlink" href="#graph" title="Permalink to this heading">#</a></h3>
<p>그래프 간소화는 복잡한 네트워크 데이터를 보다 효율적으로 처리하고 분석하기 위해 필요하다. 복잡한 도로망이나 경로 데이터를 단순화함으로써 계산 시간을 줄이고, 시각화나 경로 탐색 등의 작업을 용이하게 할 수 있다. 우리가 계속 사용해왔던 <code class="docutils literal notranslate"><span class="pre">graph_from_place</span></code> 함수는 기본적으로 <code class="docutils literal notranslate"><span class="pre">simplify=True</span></code> 인자를 사용하고 있다. 이는 OpenStreetMap에서 가져온 원시 그래프 데이터를 자동으로 간소화하여 반환한다는 의미이다.</p>
<p><code class="docutils literal notranslate"><span class="pre">simplify_graph</span></code> 함수는 불필요한 노드와 엣지를 제거하여 그래프를 단순화한다. 교차로나 말단 노드가 아닌 중간 노드들을 합침으로써 도로를 직선화하고, 그래프의 복잡성을 줄인다. 이를 통해 네트워크 분석의 효율성을 높일 수 있다.</p>
<p><code class="docutils literal notranslate"><span class="pre">consolidate_intersections</span></code> 함수는 일정 거리 이내에 있는 교차로 노드들을 하나로 통합한다. 이는 현실 세계에서 매우 근접해 있는 교차로를 단일 지점으로 처리하여 분석의 정확성을 높이고, 그래프의 구조를 더욱 간소화한다. 하지만 해당 방법은 굉장히 극단적인 방법일 수 있다. 교차로를 합친다는 것은 도로 구조의 큰 변화를 야기하므로 사용에 주의할 필요가 있다. 분석하는 공간범위가 매우 커, <code class="docutils literal notranslate"><span class="pre">simplify_graph</span></code>만으로는 분석이 어려운 경우 사용을 검토해볼 수 있겠다.</p>
<p>상세한 설명은 <a class="reference external" href="https://osmnx.readthedocs.io/en/stable/user-reference.html#osmnx.simplification.simplify_graph">https://osmnx.readthedocs.io/en/stable/user-reference.html#osmnx.simplification.simplify_graph</a> 을 참고</p>
<section id="osmnx">
<h4>[1] OSMnx에서 제공하는 그래프를 간소화 하는 두가지 함수<a class="headerlink" href="#osmnx" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the raw graph</span>
<span class="n">G_raw</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_place</span><span class="p">(</span><span class="s1">&#39;성남시, 경기도, 대한민국&#39;</span><span class="p">,</span> <span class="n">network_type</span><span class="o">=</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simplify the graph</span>
<span class="n">G_simple</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">simplify_graph</span><span class="p">(</span><span class="n">G_raw</span><span class="p">)</span>

<span class="c1"># Consolidate intersections</span>
<span class="n">G_consolidated</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">consolidate_intersections</span><span class="p">(</span><span class="n">G_simple</span><span class="p">,</span> <span class="n">rebuild_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.00057</span><span class="p">,</span> <span class="n">dead_ends</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># 약 50m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">G_raw</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">G_simple</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">G_consolidated</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># consolidated 그래프 시각화</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span>
                            <span class="n">G_simple</span><span class="p">,</span> 
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                            <span class="n">node_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                            <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.5</span>
                        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># consolidated 그래프 시각화</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span>
                            <span class="n">G_consolidated</span><span class="p">,</span> 
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                            <span class="n">node_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                            <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.5</span>
                        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simplify-graph">
<h4>[2] <code class="docutils literal notranslate"><span class="pre">simplify_graph</span></code> 자세히 살펴보기<a class="headerlink" href="#simplify-graph" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 중심 위치 지점(위도, 경도) 정의 ( 서울 시청 )</span>
<span class="n">location_point</span> <span class="o">=</span> <span class="p">(</span><span class="mf">37.5665</span><span class="p">,</span> <span class="mf">126.9780</span><span class="p">)</span>

<span class="c1"># 중심 위치로부터 500미터 거리 내에서 도로 네트워크 생성</span>
<span class="c1"># simplify=False로 설정하여 네트워크를 아직 단순화하지 않음</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_point</span><span class="p">(</span><span class="n">location_point</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># 단순화되지 않은 네트워크 그래프를 플로팅. 노드는 빨간색(r)으로 표시됨</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 네트워크가 단순화될 때 제거될 노드를 강조</span>
<span class="c1"># 끝점인 노드는 빨간색(r)으로 남고, 끝점이 아닌 노드는 노란색(y)으로 표시됨</span>
<span class="n">nc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;r&quot;</span> <span class="k">if</span> <span class="n">ox</span><span class="o">.</span><span class="n">simplification</span><span class="o">.</span><span class="n">_is_endpoint</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;y&quot;</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 네트워크를 단순화하여 불필요한 중간 노드를 병합</span>
<span class="c1"># 위의 노란색 점 제거</span>
<span class="n">G2</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">simplify_graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

<span class="c1"># 단순화된 그래프에서 자기 루프(self-loop) 엣지와 연결된 노드를 강조</span>
<span class="c1"># 자기 루프 엣지는 노드가 자기 자신과 연결되는 엣지임. 이런 노드는 빨간색(r)으로,</span>
<span class="c1"># 나머지 노드는 노란색(y)으로 표시됨</span>
<span class="n">loops</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">selfloop_edges</span><span class="p">(</span><span class="n">G2</span><span class="p">)]</span>
<span class="n">nc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;r&quot;</span> <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">loops</span> <span class="k">else</span> <span class="s2">&quot;y&quot;</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G2</span><span class="o">.</span><span class="n">nodes</span><span class="p">()]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="id11">
<h2>2.2 스마트카드 데이터 분석<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>대중교통 이용자들의 승하차 정보를 담고 있는 스마트카드 데이터는 도시 교통 패턴을 이해하는 데 핵심적인 자료입니다.</p></li>
<li><p>본 섹션에서는 서울시 지하철 승하차 데이터를 활용하여 기본적인 분석 및 시각화를 수행합니다.</p></li>
<li><p>스마트카드 데이터는 정확한 시간과 위치 정보를 제공하므로 교통 패턴 분석에 매우 유용합니다.</p></li>
</ul>
<section id="id12">
<h3>2.2.1 활용 데이터<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>서울시에서 공개하는 지하철 역별 승하차 인원수 데이터를 활용합니다.</p></li>
<li><p>데이터는 역별, 시간대별 승차 및 하차 인원수를 포함합니다.</p></li>
<li><p>본 실습에서는 하루 단위의 데이터를 사용하여 시간대별 승하차 패턴을 분석합니다.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 스마트카드 데이터 생성 (실제 데이터가 없어 샘플 데이터 생성)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="c1"># 서울시 주요 지하철역 리스트 (샘플)</span>
<span class="n">subway_stations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;강남역&#39;</span><span class="p">,</span> <span class="s1">&#39;홍대입구역&#39;</span><span class="p">,</span> <span class="s1">&#39;명동역&#39;</span><span class="p">,</span> <span class="s1">&#39;서울역&#39;</span><span class="p">,</span> <span class="s1">&#39;잠실역&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;신촌역&#39;</span><span class="p">,</span> <span class="s1">&#39;이태원역&#39;</span><span class="p">,</span> <span class="s1">&#39;여의도역&#39;</span><span class="p">,</span> <span class="s1">&#39;종로3가역&#39;</span><span class="p">,</span> <span class="s1">&#39;동대문역사문화공원역&#39;</span><span class="p">,</span>
    <span class="s1">&#39;건대입구역&#39;</span><span class="p">,</span> <span class="s1">&#39;성신여대입구역&#39;</span><span class="p">,</span> <span class="s1">&#39;왕십리역&#39;</span><span class="p">,</span> <span class="s1">&#39;구로디지털단지역&#39;</span><span class="p">,</span> <span class="s1">&#39;신림역&#39;</span>
<span class="p">]</span>

<span class="c1"># 시간대 설정 (05시부터 24시까지)</span>
<span class="n">hours</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

<span class="c1"># 샘플 스마트카드 데이터 생성</span>
<span class="n">smartcard_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">subway_stations</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">hours</span><span class="p">:</span>
        <span class="c1"># 출퇴근 시간대에 더 많은 승하차 인원 설정</span>
        <span class="n">base_boarding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">base_alighting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        
        <span class="c1"># 출근시간 (7-9시) 승차 증가</span>
        <span class="k">if</span> <span class="n">hour</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]:</span>
            <span class="n">boarding</span> <span class="o">=</span> <span class="n">base_boarding</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
        <span class="c1"># 퇴근시간 (18-20시) 하차 증가  </span>
        <span class="k">elif</span> <span class="n">hour</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">]:</span>
            <span class="n">alighting</span> <span class="o">=</span> <span class="n">base_alighting</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
            <span class="n">boarding</span> <span class="o">=</span> <span class="n">base_boarding</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boarding</span> <span class="o">=</span> <span class="n">base_boarding</span>
            <span class="n">alighting</span> <span class="o">=</span> <span class="n">base_alighting</span>
        
        <span class="n">smartcard_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;station_name&#39;</span><span class="p">:</span> <span class="n">station</span><span class="p">,</span>
            <span class="s1">&#39;hour&#39;</span><span class="p">:</span> <span class="n">hour</span><span class="p">,</span>
            <span class="s1">&#39;boarding&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">boarding</span><span class="p">),</span>
            <span class="s1">&#39;alighting&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">alighting</span> <span class="k">if</span> <span class="s1">&#39;alighting&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="k">else</span> <span class="n">base_alighting</span><span class="p">)</span>
        <span class="p">})</span>

<span class="n">smartcard_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">smartcard_data</span><span class="p">)</span>
<span class="n">smartcard_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id13">
<h3>2.2.2 시간대별 승하차 패턴 분석<a class="headerlink" href="#id13" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 시간대별 전체 승하차 인원 집계</span>
<span class="n">hourly_total</span> <span class="o">=</span> <span class="n">smartcard_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)[[</span><span class="s1">&#39;boarding&#39;</span><span class="p">,</span> <span class="s1">&#39;alighting&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># 시간대별 승하차 패턴 시각화</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hourly_total</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">hourly_total</span><span class="p">[</span><span class="s1">&#39;boarding&#39;</span><span class="p">],</span> 
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;승차 인원&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hourly_total</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">hourly_total</span><span class="p">[</span><span class="s1">&#39;alighting&#39;</span><span class="p">],</span> 
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;하차 인원&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;시간대&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;승하차 인원수&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;시간대별 지하철 승하차 패턴&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 역별 하루 총 승하차 인원 순위</span>
<span class="n">station_total</span> <span class="o">=</span> <span class="n">smartcard_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;station_name&#39;</span><span class="p">)[[</span><span class="s1">&#39;boarding&#39;</span><span class="p">,</span> <span class="s1">&#39;alighting&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">station_total</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">station_total</span><span class="p">[</span><span class="s1">&#39;boarding&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">station_total</span><span class="p">[</span><span class="s1">&#39;alighting&#39;</span><span class="p">]</span>
<span class="n">station_ranking</span> <span class="o">=</span> <span class="n">station_total</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;역별 하루 총 승하차 인원 순위 (Top 10):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">station_ranking</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id14">
<h3>2.2.3 역별 승하차 패턴 히트맵 시각화<a class="headerlink" href="#id14" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 역별-시간대별 승차 인원 피벗 테이블 생성</span>
<span class="n">boarding_pivot</span> <span class="o">=</span> <span class="n">smartcard_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;station_name&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;boarding&#39;</span><span class="p">)</span>

<span class="c1"># 히트맵 생성</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">boarding_pivot</span><span class="p">,</span> 
            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span> 
            <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.0f&#39;</span><span class="p">,</span>
            <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;승차 인원수&#39;</span><span class="p">},</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;역별-시간대별 지하철 승차 인원 히트맵&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;시간대&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;지하철역&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id15">
<h3>2.2.4 출퇴근 시간대 집중도 분석<a class="headerlink" href="#id15" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 출퇴근 시간대 정의</span>
<span class="n">rush_hour_morning</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>  <span class="c1"># 오전 출근시간</span>
<span class="n">rush_hour_evening</span> <span class="o">=</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>  <span class="c1"># 오후 퇴근시간</span>

<span class="c1"># 각 역별 출퇴근 시간 집중도 계산</span>
<span class="n">station_analysis</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">subway_stations</span><span class="p">:</span>
    <span class="n">station_data</span> <span class="o">=</span> <span class="n">smartcard_df</span><span class="p">[</span><span class="n">smartcard_df</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">station</span><span class="p">]</span>
    
    <span class="c1"># 전체 승차 인원</span>
    <span class="n">total_boarding</span> <span class="o">=</span> <span class="n">station_data</span><span class="p">[</span><span class="s1">&#39;boarding&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="c1"># 출근시간 승차 인원</span>
    <span class="n">morning_boarding</span> <span class="o">=</span> <span class="n">station_data</span><span class="p">[</span><span class="n">station_data</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rush_hour_morning</span><span class="p">)][</span><span class="s1">&#39;boarding&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="c1"># 퇴근시간 하차 인원  </span>
    <span class="n">evening_alighting</span> <span class="o">=</span> <span class="n">station_data</span><span class="p">[</span><span class="n">station_data</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rush_hour_evening</span><span class="p">)][</span><span class="s1">&#39;alighting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="c1"># 집중도 계산</span>
    <span class="n">morning_concentration</span> <span class="o">=</span> <span class="n">morning_boarding</span> <span class="o">/</span> <span class="n">total_boarding</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">total_boarding</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    
    <span class="n">station_analysis</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;station_name&#39;</span><span class="p">:</span> <span class="n">station</span><span class="p">,</span>
        <span class="s1">&#39;total_boarding&#39;</span><span class="p">:</span> <span class="n">total_boarding</span><span class="p">,</span>
        <span class="s1">&#39;morning_boarding&#39;</span><span class="p">:</span> <span class="n">morning_boarding</span><span class="p">,</span>
        <span class="s1">&#39;evening_alighting&#39;</span><span class="p">:</span> <span class="n">evening_alighting</span><span class="p">,</span>
        <span class="s1">&#39;morning_concentration&#39;</span><span class="p">:</span> <span class="n">morning_concentration</span>
    <span class="p">})</span>

<span class="n">concentration_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">station_analysis</span><span class="p">)</span>
<span class="n">concentration_df</span> <span class="o">=</span> <span class="n">concentration_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;morning_concentration&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;출근시간 승차 집중도가 높은 역 순위:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">concentration_df</span><span class="p">[[</span><span class="s1">&#39;station_name&#39;</span><span class="p">,</span> <span class="s1">&#39;morning_concentration&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="gtfs-general-transit-feed-specification">
<h2>2.5 GTFS (General Transit Feed Specification)<a class="headerlink" href="#gtfs-general-transit-feed-specification" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>대중교통 네트워크 분석을 위한 데이터</p></li>
<li><p>향후 업데이트 예정</p></li>
</ul>
</section>
<section id="exercise">
<h2>2.6 Exercise<a class="headerlink" href="#exercise" title="Permalink to this heading">#</a></h2>
<p>GPT와 같은 AI 툴을 적극 활용해 문제를 풀어봅시다. 다만, 출력된 코드를 보고 이해하고, 코드가 실행되지 않는다면 어디서 실행되지 않는지 파악하고 올바르게 수정할 수 있어야 합니다.</p>
<section id="id16">
<h3>2.6.1 통행 수요 데이터 분석 및 시각화<a class="headerlink" href="#id16" title="Permalink to this heading">#</a></h3>
<blockquote>
<div><p>2.1 Section에서 불러온 2024년 3월 27일 통행 데이터를 가지고 아래와 같은 분석을 수행해보자.</p>
</div></blockquote>
<ol class="arabic simple">
<li><p>시간에 따른 통행량을 그래프로 시각화 해보자. 몇시에 통행이 가장 많으며, 그 양은 얼마인가?</p></li>
<li><p>공간에 따른 통행량의 분포를 읍면동 단위로 시각화 해보자. 어느 지역에서 출발 통행량(Trip Production)이 가장 많으며 어느 지역에서 도착 통행량 (Trip Attraction)이 가장 많은가?</p></li>
<li><p>통행의 시공간적 분포를 함께 분석해보자. 가장 효과적인 시각화 방안은 무엇일까?</p></li>
<li><p>출발통행, 도착통행이 아닌, 출발지-목적지간의 통행을 시각화 해보자. O-D pairs의 수가 지나치게 많다면 이를 효과적으로 시각화 할 수 있을까? 어떤 패키지나 소프트웨어를 활용하면 좋을지 고민해보자.</p></li>
</ol>
</section>
<section id="id17">
<h3>2.6.2 스마트카드 데이터 분석 및 시각화<a class="headerlink" href="#id17" title="Permalink to this heading">#</a></h3>
<blockquote>
<div><p>2.2 Section에서 구현한 스마트카드 데이터 분석 코드를 참고하여 아래와 같은 추가 분석을 수행해보자.</p>
</div></blockquote>
<ol class="arabic simple">
<li><p>요일별 승하차 패턴의 차이를 분석해보자. 주중과 주말의 패턴이 어떻게 다른가?</p></li>
<li><p>역별 승하차 불균형을 분석해보자. 주로 승차가 많은 역과 하차가 많은 역을 구분할 수 있는가?</p></li>
<li><p>시간대별 네트워크 부하를 계산해보자. 가장 혼잡한 시간대는 언제인가?</p></li>
</ol>
</section>
<section id="id18">
<h3>2.6.3 통행 시간 데이터 분석 및 시각화<a class="headerlink" href="#id18" title="Permalink to this heading">#</a></h3>
<blockquote>
<div><p>2.3 Section에서 불러온 가상의 택시 통행 데이터를 가지고 아래와 같은 분석을 수행해보자.</p>
</div></blockquote>
<ol class="arabic simple">
<li><p>택시 통행 데이터의 각 행에, 출발지역의 행정동 코드 &amp; 도착지역의 행정동 코드를 매핑해봅시다. 이후 아래문제를 풀어보세요. <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> 패키지에 있는  <code class="docutils literal notranslate"><span class="pre">sjoin</span></code> 함수를 사용하면 됩니다.</p></li>
<li><p>청담동에서 출발해서 연희동 도착하는 택시 통행만을 추출하여, 출발 시간대별(1시간단위로 합산) 통행시간의 변화를 Line Graph로 그려봅시다. 언제 가장 시간이 오래 걸리나요?</p></li>
</ol>
</section>
<section id="id19">
<h3>2.6.4 도로네트워크 분석<a class="headerlink" href="#id19" title="Permalink to this heading">#</a></h3>
<blockquote>
<div><p>2.4 Section에서 실습한 OSM 데이터를 분석하는 코드를 참고하면서 아래 문제를 풀어보자.</p>
</div></blockquote>
<ol class="arabic simple">
<li><p>가천대학교 AI공학관에서 가천대역까지 가는 최단경로를 뽑아보고 지도상에 시각화 해봅시다. 해당 위치의 좌표는 어떻게 알 수 있을까요? (<a class="reference external" href="https://www.google.com/maps">구글지도</a>를 사용해봅시다)</p></li>
<li><p>가천대역을 중심으로 하여 도보로 15분 내에 도달 가능한 지역을 지도상에 나타내봅시다. 사람의 통행속도는 5km/h로 가정합니다.</p></li>
</ol>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ko"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="chapter1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">1. Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="chapter3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">3. Models for Predicting Estimated Time of Arrival</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.1 수도권 생활이동 데이터 분석</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.1.1 활용 데이터</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.1.2 데이터 읽기 및 간단한 전처리</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-visualization">2.1.3 Basic visualization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#travel-time-data-taxi-trip-record">2.3 Travel Time Data (Taxi Trip Record)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.3.1 데이터 읽기</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2.3.2 Basic Visualization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#road-network-and-geometry">2.4 Road Network and Geometry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#open-street-map">2.4.1 Open Street Map 데이터 살펴보기</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#open-street-map-osm-pbf">[1] Open Street Map 데이터 취득하기 (.osm.pbf 파일)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#osm">[2] 내가 원하는 지역 osm 지도를 그래프 형태로 표현</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">[3] 여러 네트워크를 한번에 표시</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">[4]  기초적인 도로네트워크 속성 파악 및 시각화</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">2.4.2 최단거리 분석</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#network-distance">[1] 두 지점간 Network Distance 구하기 실습</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">[2] 이동 속도 및 시간 영향을 고려한 경로 산출</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">[3] 특정 노드에서 지정한 거리/시간에 도달할 수 있는 노드 분석( 버퍼 )</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graph">2.4.3 Graph 간소화</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#osmnx">[1] OSMnx에서 제공하는 그래프를 간소화 하는 두가지 함수</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simplify-graph">[2] <code class="docutils literal notranslate"><span class="pre">simplify_graph</span></code> 자세히 살펴보기</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">2.2 스마트카드 데이터 분석</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">2.2.1 활용 데이터</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">2.2.2 시간대별 승하차 패턴 분석</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">2.2.3 역별 승하차 패턴 히트맵 시각화</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">2.2.4 출퇴근 시간대 집중도 분석</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gtfs-general-transit-feed-specification">2.5 GTFS (General Transit Feed Specification)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">2.6 Exercise</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">2.6.1 통행 수요 데이터 분석 및 시각화</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">2.6.2 스마트카드 데이터 분석 및 시각화</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">2.6.3 통행 시간 데이터 분석 및 시각화</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">2.6.4 도로네트워크 분석</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jiho Yeo
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>